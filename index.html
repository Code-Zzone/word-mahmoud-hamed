<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ù…Ø­Ø±Ø± Ø§Ù„Ø´Ø§Ù…Ù„ - Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª ÙˆØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    <!-- Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„ØªØµØ¯ÙŠØ± -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        /* ========================================= */
        /* Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ§Øª */
        /* ========================================= */
        :root {
            --primary: #2e7d32; /* Ø£Ø®Ø¶Ø± Ù…Ø±ÙŠØ­ Ù„Ù„Ø¹ÙŠÙ† (Ø¥ÙƒØ³Ù„ Ø³ØªØ§ÙŠÙ„) */
            --bg: #f5f5f5;
            --border: #ccc;
        }

        body {
            font-family: 'Cairo', sans-serif;
            background-color: var(--bg);
            margin: 0;
            padding-right: 280px;
            direction: rtl;
        }

        /* Sidebar Ø§Ø­ØªØ±Ø§ÙÙŠ */
        .toolbar {
            position: fixed; 
            top: 0; 
            right: 0; 
            width: 280px;
            height: 100vh;
            background: linear-gradient(180deg, #ffffff 0%, #f5f5f5 100%);
            border-left: 3px solid var(--primary);
            box-shadow: -4px 0 12px rgba(0,0,0,0.1);
            z-index: 1000;
            display: flex; 
            flex-direction: column;
            gap: 10px; 
            padding: 15px 10px;
            overflow-y: auto;
            overflow-x: hidden;
        }
        
        .toolbar::-webkit-scrollbar {
            width: 6px;
        }
        
        .toolbar::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        
        .toolbar::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 3px;
        }
        
        .toolbar-toggle {
            display: none;
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 1001;
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 20px;
        }

        .group {
            display: flex; 
            flex-direction: column; 
            align-items: stretch;
            border-bottom: 1px solid #ddd; 
            padding: 10px 0;
            margin-bottom: 5px;
        }
        .group-title { 
            font-size: 12px; 
            color: var(--primary); 
            margin-bottom: 8px; 
            font-weight: bold;
            padding: 5px 10px;
            background: rgba(46, 125, 50, 0.1);
            border-radius: 5px;
        }
        .row { 
            display: flex; 
            flex-direction: column;
            gap: 5px; 
            align-items: stretch; 
            margin-bottom: 5px;
            padding: 0 5px;
        }
        .row.horizontal {
            flex-direction: row;
            flex-wrap: wrap;
        }

        button, select {
            padding: 5px 10px; border: 1px solid #ccc; background: #fff;
            cursor: pointer; border-radius: 4px; font-family: 'Cairo'; font-size: 13px;
            transition: 0.2s; display: flex; align-items: center; justify-content: center; gap: 5px;
        }
        button:hover { background: #e8f5e9; border-color: var(--primary); }
        button.active { background: #c8e6c9; border-color: var(--primary); }
        
        button.primary-btn { background: var(--primary); color: white; border: none; }
        button.danger-btn { color: #d32f2f; background: #ffebee; border-color: #ffcdd2; }
        button.calc-btn { background: #fff3e0; color: #e65100; border-color: #ffe0b2; }

        /* Ø§Ù„Ø£Ù„ÙˆØ§Ù† */
        .color-wrapper { position: relative; width: 32px; height: 32px; border: 1px solid #ccc; border-radius: 4px; overflow: hidden; display: flex; align-items: center; justify-content: center; font-weight: bold;}
        .color-wrapper input { position: absolute; left: -50%; top: -50%; width: 200%; height: 200%; cursor: pointer; opacity: 0; }
        .color-preview { width: 100%; height: 100%; position: absolute; z-index: 0; }
        .color-icon { position: relative; z-index: 1; pointer-events: none; text-shadow: 0 0 2px white; }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¹Ù…Ù„ */
        .workspace {
            display: flex; flex-direction: column; align-items: center; gap: 30px; padding-bottom: 50px;
        }
        .a4-page {
            width: 210mm; min-height: 297mm;
            background: white; padding: 20mm;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            position: relative; box-sizing: border-box;
            display: flex;
            flex-direction: column;
        }
        .a4-page.drag-over {
            background-color: #e8f5e9;
            border: 2px dashed var(--primary);
        }
        .page-content {
            flex: 1;
            min-height: 0;
        }
        .page-footer {
            margin-top: auto;
            padding-top: 8mm;
            padding-bottom: 5mm;
            text-align: center;
            color: #333;
            font-size: 9pt;
            font-family: 'Cairo', sans-serif;
            line-height: 1.6;
            border-top: 2px solid #2e7d32;
        }
        .page-footer .company-name {
            font-weight: bold;
            color: #2e7d32;
            margin-bottom: 5px;
            font-size: 11pt;
            letter-spacing: 1px;
        }
        .page-footer .company-info {
            font-size: 8pt;
            color: #666;
            margin: 3px 0;
        }
        .page-footer .print-date {
            font-size: 8pt;
            color: #999;
            margin-top: 5px;
        }
        
        /* Ø§Ù„Ø®Ø· Ø§Ù„ÙØ§ØµÙ„ */
        .divider-line {
            width: 100%;
            height: 1px;
            background: #ddd;
            margin: 10px 0;
            border: none;
        }
        .divider-line.thick {
            height: 2px;
            background: #999;
        }
        .divider-line.dashed {
            border-top: 1px dashed #ccc;
            background: none;
            height: 0;
        }
        .page-header {
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            background: linear-gradient(135deg, #2e7d32 0%, #1b5e20 100%);
            color: white; 
            padding: 8px 15px;
            border-radius: 5px 5px 0 0; 
            font-size: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        /* Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ Ù„Ù„ØªØµØ¯ÙŠØ± */
        .export-header {
            display: none;
            background: linear-gradient(135deg, #2e7d32 0%, #1b5e20 100%);
            color: white;
            padding: 15px 20px;
            text-align: center;
            border-bottom: 3px solid #1b5e20;
        }
        
        .export-header.active {
            display: block;
        }
        
        .export-header .company-logo {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
            letter-spacing: 2px;
        }
        
        .export-header .company-full-name {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .export-header .company-tagline {
            font-size: 11px;
            opacity: 0.9;
            margin-top: 5px;
        }
        
        /* ØªØ°ÙŠÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ Ù„Ù„ØªØµØ¯ÙŠØ± */
        .export-footer {
            display: none;
            background: #f5f5f5;
            border-top: 2px solid #2e7d32;
            padding: 12px 20px;
            text-align: center;
            color: #333;
            font-size: 9pt;
        }
        
        .export-footer.active {
            display: block;
        }
        
        .export-footer .company-name {
            font-weight: bold;
            color: #2e7d32;
            font-size: 11pt;
            margin-bottom: 5px;
        }
        
        .export-footer .company-details {
            font-size: 8pt;
            color: #666;
            line-height: 1.6;
        }
        
        /* ØªÙ†Ø³ÙŠÙ‚ Ø®Ø§Øµ Ù„Ù„Ø·Ø¨Ø§Ø¹Ø© ÙˆØ§Ù„ØªØµØ¯ÙŠØ± */
        @media print {
            .toolbar, .page-header, .block-tools, .img-handle, .img-controls, 
            .selected-img, .help-modal, .page-margin-controls, .border-controls,
            .export-menu { 
                display: none !important; 
            }
            .export-header, .export-footer {
                display: block !important;
            }
            body {
                padding: 0;
                background: white;
            }
            .a4-page {
                box-shadow: none;
                margin: 0;
                page-break-after: always;
            }
        }
        
        /* ØªÙ†Ø³ÙŠÙ‚ Ø®Ø§Øµ Ù„Ù„ØªØµØ¯ÙŠØ± */
        .export-mode .export-header,
        .export-mode .export-footer {
            display: block;
        }
        
        .export-mode .toolbar {
            display: none;
        }
        
        .export-mode body {
            padding: 0;
        }

        /* Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ */
        .editable-block { 
            position: relative; 
            border: 1px dashed transparent; 
            margin-bottom: 15px; 
            padding: 5px;
            transition: all 0.2s;
        }
        .editable-block:hover { 
            border-color: #bbb; 
            background: rgba(46, 125, 50, 0.02);
        }
        .editable-block.deletable-text {
            cursor: pointer;
        }
        .editable-block.deletable-text:hover {
            background: rgba(211, 47, 47, 0.1);
            border-color: #d32f2f;
        }
        .editable-block.deletable-text::after {
            content: 'ğŸ—‘ï¸';
            position: absolute;
            left: -30px;
            top: 50%;
            transform: translateY(-50%);
            opacity: 0;
            transition: opacity 0.2s;
            font-size: 16px;
        }
        .editable-block.deletable-text:hover::after {
            opacity: 1;
        }
        .editable-block.draggable-table,
        .editable-block.draggable-text {
            cursor: move;
        }
        .editable-block.draggable-table.dragging,
        .editable-block.draggable-text.dragging {
            opacity: 0.7;
            z-index: 1000;
            box-shadow: 0 8px 16px rgba(0,0,0,0.3);
            transform: scale(1.02);
        }
        
        /* ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø¨ÙˆØ±Ø¯Ø± ÙˆØ§Ù„Ø¹Ø±Ø¶ */
        .border-controls {
            position: absolute;
            top: -120px;
            right: 0;
            background: white;
            padding: 12px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            display: none;
            gap: 8px;
            flex-direction: column;
            z-index: 100;
            border: 2px solid var(--primary);
            min-width: 220px;
        }
        .editable-block.selected-block .border-controls {
            display: flex;
        }
        
        /* ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø¹Ø±Ø¶ */
        .width-controls {
            position: absolute;
            top: -180px;
            right: 0;
            background: white;
            padding: 12px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            display: none;
            gap: 8px;
            flex-direction: column;
            z-index: 100;
            border: 2px solid #1976d2;
            min-width: 220px;
        }
        .editable-block.selected-block .width-controls {
            display: flex;
        }
        
        .width-controls h4 {
            margin: 0 0 8px 0;
            color: #1976d2;
            font-size: 12px;
            text-align: center;
        }
        
        .width-preset-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
            margin-bottom: 8px;
        }
        
        .width-preset-btn {
            padding: 6px;
            border: 1px solid #1976d2;
            background: white;
            color: #1976d2;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
            transition: all 0.2s;
        }
        
        .width-preset-btn:hover {
            background: #1976d2;
            color: white;
        }
        .border-input-group {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 11px;
        }
        .border-input-group label {
            min-width: 80px;
            font-weight: bold;
        }
        .border-input-group input,
        .border-input-group select {
            flex: 1;
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        
        /* ØªØ­ÙƒÙ… ÙÙŠ Ù‡ÙˆØ§Ù…Ø´ Ø§Ù„ØµÙØ­Ø© */
        .page-margin-controls {
            position: fixed;
            top: 50%;
            left: 20px;
            transform: translateY(-50%);
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            z-index: 999;
            display: none;
            flex-direction: column;
            gap: 12px;
            min-width: 220px;
            border: 3px solid var(--primary);
        }
        .page-margin-controls.active {
            display: flex;
        }
        .page-margin-controls h3 {
            margin: 0 0 10px 0;
            color: var(--primary);
            font-size: 16px;
            text-align: center;
        }
        .margin-control-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .margin-control-group label {
            min-width: 70px;
            font-weight: bold;
            font-size: 12px;
        }
        .margin-control-group input {
            width: 70px;
            padding: 6px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .margin-control-group button {
            padding: 6px 12px;
            margin-top: 5px;
        }
        .block-tools { 
            position: absolute; 
            right: -35px; 
            top: 0; 
            display: none; 
            flex-direction: column; 
            gap: 2px;
            z-index: 50;
        }
        .editable-block:hover .block-tools,
        .editable-block.selected-block .block-tools { 
            display: flex; 
        }
        .mini-btn { 
            width: 28px; 
            height: 28px; 
            padding: 0; 
            border-radius: 50%; 
            font-size: 14px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .mini-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 3px 6px rgba(0,0,0,0.3);
        }
        .editable-block.selected-block {
            border-color: var(--primary) !important;
            border-style: solid !important;
        }

        table { width: 100%; border-collapse: collapse; table-layout: fixed; margin: 0 auto; }
        th, td { border: 1px solid #999; padding: 5px; position: relative; word-wrap: break-word; }
        th { background-color: #eee; font-weight: bold; text-align: center; }

        /* Ø§Ù„ØªØ­Ø¯ÙŠØ¯ */
        .selected { background-color: rgba(46, 125, 50, 0.2) !important; outline: 2px solid var(--primary); z-index: 10; }
        .resizer { position: absolute; left: 0; top: 0; bottom: 0; width: 5px; cursor: col-resize; z-index: 20; }
        
        /* Ø§Ù„ØµÙˆØ± */
        .resizable-img-wrapper { 
            display: inline-block; 
            position: absolute; 
            vertical-align: middle; 
            border: 1px solid transparent; 
            margin: 0;
            padding: 0;
            transition: border 0.2s;
            cursor: move;
            z-index: 5;
        }
        .resizable-img-wrapper.dragging {
            opacity: 0.7;
            z-index: 1000;
        }
        .resizable-img-wrapper:hover { 
            border: 1px dashed var(--primary); 
        }
        .resizable-img-wrapper.selected-img { 
            border: 2px solid var(--primary); 
            box-shadow: 0 0 0 2px rgba(46, 125, 50, 0.2);
        }
        .resizable-img-wrapper img { 
            display: block; 
            width: 100%; 
            height: auto; 
            pointer-events: auto;
            cursor: move;
        }
        .img-margin-controls {
            position: absolute;
            top: -280px;
            right: 0;
            background: white;
            padding: 12px;
            border-radius: 5px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            display: none;
            gap: 8px;
            flex-direction: column;
            z-index: 100;
            border: 1px solid #ddd;
            min-width: 220px;
            max-height: 250px;
            overflow-y: auto;
            pointer-events: auto;
        }
        .resizable-img-wrapper.selected-img .img-margin-controls {
            display: flex;
        }
        .margin-input-group {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 11px;
        }
        .margin-input-group label {
            min-width: 60px;
            font-weight: bold;
        }
        .margin-input-group input {
            width: 50px;
            padding: 3px;
            border: 1px solid #ccc;
            border-radius: 3px;
            text-align: center;
        }
        .img-handle { 
            width: 14px; 
            height: 14px; 
            background: var(--primary); 
            position: absolute; 
            cursor: nwse-resize; 
            display: none; 
            border-radius: 50%; 
            border: 2px solid white; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            z-index: 10;
        }
        .img-handle.bottom-right { bottom: -7px; right: -7px; }
        .img-handle.bottom-left { bottom: -7px; left: -7px; cursor: nesw-resize; }
        .img-handle.top-right { top: -7px; right: -7px; cursor: nesw-resize; }
        .img-handle.top-left { top: -7px; left: -7px; }
        .resizable-img-wrapper:hover .img-handle,
        .resizable-img-wrapper.selected-img .img-handle { 
            display: block; 
        }
        .img-controls { 
            position: absolute; 
            top: -50px; 
            right: 0; 
            background: white; 
            padding: 8px; 
            border-radius: 5px; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.2); 
            display: none; 
            gap: 5px; 
            flex-wrap: wrap; 
            z-index: 100; 
            border: 1px solid #ddd;
            pointer-events: auto;
        }
        .resizable-img-wrapper.selected-img .img-controls { 
            display: flex; 
        }
        .img-controls button { 
            padding: 4px 8px; 
            font-size: 11px; 
            min-width: 30px;
        }
        
        /* Ø­Ø¬Ù… Ø§Ù„Ø®Ø· */
        .font-size-control { display: flex; align-items: center; gap: 5px; }
        .font-size-control input { width: 50px; padding: 3px; border: 1px solid #ccc; border-radius: 3px; text-align: center; }
        .font-size-control select { padding: 3px; border: 1px solid #ccc; border-radius: 3px; }

        @media (max-width: 768px) {
            body {
                padding-right: 0;
            }
            .toolbar {
                transform: translateX(100%);
                transition: transform 0.3s;
            }
            .toolbar.active {
                transform: translateX(0);
            }
            .toolbar-toggle {
                display: block;
            }
        }
        
        @media print {
            .toolbar, .page-header, .block-tools, .img-handle, .img-controls, .selected-img, .help-modal, .page-margin-controls, .border-controls { 
                display: none !important; 
            }
            .resizable-img-wrapper { 
                border: none !important; 
            }
            .a4-page { 
                box-shadow: none; 
                margin: 0; 
                width: 100%; 
                height: auto; 
            }
            .editable-block { 
                border: none !important; 
            }
            .page-footer {
                position: absolute;
                bottom: 10mm;
                left: 0;
                right: 0;
                width: 100%;
            }
        }
        
        /* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØµØ¯ÙŠØ± */
        .export-menu {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border: 2px solid var(--primary);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            z-index: 2000;
            display: none;
            min-width: 300px;
        }
        
        .export-menu.active {
            display: block;
        }
        
        .export-menu h3 {
            margin: 0 0 15px 0;
            color: var(--primary);
            text-align: center;
        }
        
        .export-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .export-btn {
            padding: 12px 20px;
            border: 2px solid var(--primary);
            background: white;
            color: var(--primary);
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .export-btn:hover {
            background: var(--primary);
            color: white;
        }
        
        .export-btn.pdf {
            border-color: #d32f2f;
            color: #d32f2f;
        }
        
        .export-btn.pdf:hover {
            background: #d32f2f;
            color: white;
        }
        
        .export-btn.png {
            border-color: #1976d2;
            color: #1976d2;
        }
        
        .export-btn.png:hover {
            background: #1976d2;
            color: white;
        }
        
        .export-close {
            position: absolute;
            top: 10px;
            left: 10px;
            background: #d32f2f;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        
        /* Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© */
        .help-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 10000;
            overflow-y: auto;
        }
        .help-modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .help-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        .help-content h2 {
            color: var(--primary);
            margin-bottom: 20px;
            text-align: center;
        }
        .help-section {
            margin-bottom: 25px;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 5px;
        }
        .help-section h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 18px;
        }
        .help-section ul {
            list-style: none;
            padding: 0;
        }
        .help-section li {
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        .help-section li:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body>

    <!-- Toggle Button -->
    <button class="toolbar-toggle" onclick="toggleSidebar()">â˜°</button>
    
    <!-- Toolbar -->
    <div class="toolbar" id="sidebar">
        <input type="file" id="logoInput" accept="image/*" style="display: none;" onchange="handleImageUpload(this)">

        <div class="group">
            <span class="group-title">Ø¥Ø¯Ø±Ø§Ø¬</span>
            <div class="row">
                <button onclick="addBlock('table')" class="primary-btn">â–¦ Ø¬Ø¯ÙˆÙ„</button>
                <button onclick="addImageWithPageSelect()">ğŸ–¼ï¸ ØµÙˆØ±Ø©</button>
                <button onclick="addBlock('text')">ğŸ“ Ù†Øµ</button>
            </div>
            <div class="row">
                <button onclick="addBlock('heading')">H Ø¹Ù†ÙˆØ§Ù†</button>
                <button onclick="addBlock('paragraph')">ğŸ“ ÙÙ‚Ø±Ø©</button>
                <button onclick="addBlock('description')">ğŸ“„ ÙˆØµÙ</button>
            </div>
            <div class="row">
                <button onclick="addBlock('divider')" title="Ø¥Ø¶Ø§ÙØ© Ø®Ø· ÙØ§ØµÙ„">â– Ø®Ø·</button>
            </div>
            <div class="row">
                <button onclick="addPage()" style="background:#333; color:white;">ğŸ“„ ØµÙØ­Ø© +</button>
            </div>
        </div>

        <!-- Ù‚Ø³Ù… Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª ÙˆØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ø¬Ø¯ÙŠØ¯) -->
        <div class="group" style="background:#fffde7;">
            <span class="group-title">Ø­Ø³Ø§Ø¨Ø§Øª ÙˆØ¨ÙŠØ§Ù†Ø§Øª</span>
            <div class="row">
                <button onclick="calcSum('alert')" class="calc-btn" title="ÙŠØ¹Ø±Ø¶ Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø®Ù„Ø§ÙŠØ§ Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© ÙÙŠ Ø±Ø³Ø§Ù„Ø©">âˆ‘ Ù…Ø¬Ù…ÙˆØ¹</button>
                <button onclick="calcSum('insert')" class="calc-btn" title="ÙŠØ¯Ø±Ø¬ Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø®Ù„Ø§ÙŠØ§ Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©">ğŸ“ Ø¥Ø¯Ø±Ø§Ø¬ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</button>
            </div>
            <div class="row">
                <button onclick="calcOperation('subtract')" class="calc-btn" title="Ø·Ø±Ø­">â– Ø·Ø±Ø­</button>
                <button onclick="calcOperation('multiply')" class="calc-btn" title="Ø¶Ø±Ø¨">âœ–ï¸ Ø¶Ø±Ø¨</button>
                <button onclick="calcOperation('divide')" class="calc-btn" title="Ù‚Ø³Ù…Ø©">â— Ù‚Ø³Ù…Ø©</button>
            </div>
            <div class="row">
                <button onclick="addTotalRow()" class="calc-btn" style="font-weight:bold;">â• ØµÙ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</button>
            </div>
        </div>

        <div class="group">
            <span class="group-title">ØªØ±Ù‚ÙŠÙ… ÙˆÙ‡ÙŠÙƒÙ„Ø©</span>
            <div class="row">
                <button onclick="execTable('addrow')">â• ØµÙ</button>
                <button onclick="execTable('addcol')">â• Ø¹Ù…ÙˆØ¯</button>
                <button onclick="autoNumber()" style="background:#e8f5e9;">ğŸ”¢ ØªØ±Ù‚ÙŠÙ…</button>
            </div>
            <div class="row">
                <button onclick="execTable('delrow')" class="danger-btn" title="Ø­Ø°Ù Ø§Ù„ØµÙ Ø§Ù„Ù…Ø­Ø¯Ø¯">â– Ø­Ø°Ù ØµÙ</button>
                <button onclick="execTable('delcol')" class="danger-btn" title="Ø­Ø°Ù Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ù…Ø­Ø¯Ø¯">â– Ø­Ø°Ù Ø¹Ù…ÙˆØ¯</button>
            </div>
            <div class="row">
                <button onclick="removeNumbering()" class="danger-btn" title="Ø­Ø°Ù Ø¹Ù…ÙˆØ¯ Ø§Ù„ØªØ±Ù‚ÙŠÙ…">ğŸš« Ø­Ø°Ù Ø§Ù„ØªØ±Ù‚ÙŠÙ…</button>
                <button onclick="deleteFullTable()" class="danger-btn">ğŸ—‘ï¸ Ø¬Ø¯ÙˆÙ„</button>
            </div>
        </div>

        <div class="group" style="background:#e3f2fd;">
            <span class="group-title">Ø¯Ù…Ø¬ ÙˆØªØ­Ø¯ÙŠØ¯</span>
            <div class="row">
                <button onclick="mergeCells()">ğŸ”— Ø¯Ù…Ø¬</button>
                <button onclick="unmergeCells()">ğŸ’” ÙÙƒ</button>
            </div>
            <div class="row">
                <small style="font-size:10px; color:#1565c0;">(Ctrl + Ù†Ù‚Ø± Ù„Ù„ØªØ­Ø¯ÙŠØ¯)</small>
            </div>
        </div>

        <div class="group">
            <span class="group-title">ØªÙ†Ø³ÙŠÙ‚</span>
            <div class="row">
                <div class="color-wrapper" title="Ù„ÙˆÙ† Ø§Ù„Ù†Øµ">
                    <div class="color-preview" id="tp" style="background:black;"></div><span class="color-icon" style="color:white;">A</span>
                    <input type="color" onchange="applyColor('text',this.value); document.getElementById('tp').style.background=this.value;">
                </div>
                <div class="color-wrapper" title="Ù„ÙˆÙ† Ø§Ù„Ø®Ù„ÙÙŠØ©">
                    <div class="color-preview" id="bp" style="background:yellow;"></div><span class="color-icon">ğŸ¨</span>
                    <input type="color" onchange="applyColor('bg',this.value); document.getElementById('bp').style.background=this.value;">
                </div>
                <button onclick="document.execCommand('bold')"><b>B</b></button>
                <button onclick="document.execCommand('italic')"><i>I</i></button>
                <button onclick="document.execCommand('underline')"><u>U</u></button>
            </div>
            <div class="row">
                <div class="font-size-control">
                    <input type="number" id="fontSizeInput" min="8" max="72" value="14" onchange="applyFontSize(this.value)" style="width:50px;">
                    <select id="fontSizeUnit" onchange="applyFontSize(document.getElementById('fontSizeInput').value)">
                        <option value="px">px</option>
                        <option value="pt">pt</option>
                        <option value="em">em</option>
                    </select>
                    <button onclick="quickFontSize(12)">12</button>
                    <button onclick="quickFontSize(16)">16</button>
                    <button onclick="quickFontSize(20)">20</button>
                </div>
            </div>
            <div class="row">
                <button onclick="align('right')">â¡ï¸</button>
                <button onclick="align('center')">âºï¸</button>
                <button onclick="align('left')">â¬…ï¸</button>
            </div>
        </div>
        
        <div class="group" style="background:#f3e5f5;">
            <span class="group-title">ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„ØµÙˆØ±</span>
            <div class="row">
                <button onclick="selectImage()" title="Ø­Ø¯Ø¯ ØµÙˆØ±Ø© Ø£ÙˆÙ„Ø§Ù‹">ğŸ–¼ï¸ ØªØ­Ø¯ÙŠØ¯</button>
                <button onclick="deleteSelectedImage()" class="danger-btn">ğŸ—‘ï¸ Ø­Ø°Ù</button>
            </div>
            <div class="row horizontal">
                <button onclick="resizeImage(50)" title="ØªØµØºÙŠØ±">ğŸ”½</button>
                <button onclick="resizeImage(100)" title="Ø¹Ø§Ø¯ÙŠ">â¹ï¸</button>
                <button onclick="resizeImage(150)" title="ØªÙƒØ¨ÙŠØ±">ğŸ”¼</button>
            </div>
            <div class="row horizontal">
                <button onclick="alignImage('left')">â¬…ï¸</button>
                <button onclick="alignImage('center')">âºï¸</button>
                <button onclick="alignImage('right')">â¡ï¸</button>
            </div>
        </div>
        
        <div class="group" style="background:#e1f5fe;">
            <span class="group-title">ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ù…Ø­ØªÙˆÙ‰</span>
            <div class="row">
                <button onclick="showBorderControls()" title="ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø¨ÙˆØ±Ø¯Ø±">ğŸ”² Ø¨ÙˆØ±Ø¯Ø±</button>
                <button onclick="showWidthControls()" title="ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø¹Ø±Ø¶">ğŸ“ Ø¹Ø±Ø¶</button>
                <button onclick="togglePageMargins()" title="Ù‡ÙˆØ§Ù…Ø´ Ø§Ù„ØµÙØ­Ø©">ğŸ“ Ù‡ÙˆØ§Ù…Ø´</button>
            </div>
        </div>
        
        <div class="group" style="background:#e8f5e9;">
            <span class="group-title">Ø£Ø¯ÙˆØ§Øª Ø¥Ø¶Ø§ÙÙŠØ©</span>
            <div class="row">
                <button onclick="document.execCommand('copy')" title="Ù†Ø³Ø®">ğŸ“‹ Ù†Ø³Ø®</button>
                <button onclick="document.execCommand('paste')" title="Ù„ØµÙ‚">ğŸ“„ Ù„ØµÙ‚</button>
                <button onclick="document.execCommand('undo')" title="ØªØ±Ø§Ø¬Ø¹">â†¶ ØªØ±Ø§Ø¬Ø¹</button>
                <button onclick="document.execCommand('redo')" title="Ø¥Ø¹Ø§Ø¯Ø©">â†· Ø¥Ø¹Ø§Ø¯Ø©</button>
            </div>
            <div class="row">
                <button onclick="saveDocument()" class="primary-btn" title="Ø­ÙØ¸">ğŸ’¾ Ø­ÙØ¸</button>
                <button onclick="showExportMenu()" title="ØªØµØ¯ÙŠØ±">ğŸ“¥ ØªØµØ¯ÙŠØ±</button>
            </div>
            <div class="row">
                <button onclick="clearPage()" class="danger-btn" title="Ù…Ø³Ø­ Ø§Ù„ØµÙØ­Ø©">ğŸ—‘ï¸ Ù…Ø³Ø­</button>
                <button onclick="showHelp()" style="background:#2196F3; color:white; border-radius:8px; padding:10px; font-weight:bold;" title="Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…">â“ Ù…Ø³Ø§Ø¹Ø¯Ø©</button>
            </div>
        </div>
    </div>
    
    <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØµØ¯ÙŠØ± -->
    <div class="export-menu" id="exportMenu">
        <button class="export-close" onclick="closeExportMenu()">âœ•</button>
        <h3>ğŸ“¥ ØªØµØ¯ÙŠØ± Ø§Ù„Ù…Ø³ØªÙ†Ø¯</h3>
        <div class="export-options">
            <button class="export-btn pdf" onclick="exportToPDF()">
                ğŸ“„ ØªØµØ¯ÙŠØ± ÙƒÙ€ PDF
            </button>
            <button class="export-btn png" onclick="exportToPNG()">
                ğŸ–¼ï¸ ØªØµØ¯ÙŠØ± ÙƒÙ€ PNG
            </button>
        </div>
    </div>
    
    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© -->
    <div class="help-modal" id="helpModal">
        <div class="help-content">
            <h2>ğŸ“– Ø¯Ù„ÙŠÙ„ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ø­Ø±Ø±</h2>
            <button onclick="closeHelp()" style="position:absolute; top:10px; left:10px; background:#d32f2f; color:white; border:none; padding:5px 10px; border-radius:5px; cursor:pointer;">âœ• Ø¥ØºÙ„Ø§Ù‚</button>
            
            <div class="help-section">
                <h3>ğŸ¯ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„</h3>
                <ul>
                    <li><strong>Ø¥Ø¶Ø§ÙØ© Ø¬Ø¯ÙˆÙ„:</strong> Ø§Ø¶ØºØ· Ø²Ø± "Ø¬Ø¯ÙˆÙ„" Ù„Ø¥Ø¶Ø§ÙØ© Ø¬Ø¯ÙˆÙ„ Ø¬Ø¯ÙŠØ¯</li>
                    <li><strong>ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø¬Ø¯ÙˆÙ„:</strong> Ø§Ø¶ØºØ· ÙˆØ§Ø³Ø­Ø¨ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù„ØªØ­Ø±ÙŠÙƒÙ‡ ÙÙŠ Ø§Ù„ØµÙØ­Ø©</li>
                    <li><strong>ØªØ­Ø¯ÙŠØ¯ Ø®Ù„Ø§ÙŠØ§:</strong> Ø§Ø¶ØºØ· Ctrl + Ù†Ù‚Ø± Ù„ØªØ­Ø¯ÙŠØ¯ Ø®Ù„Ø§ÙŠØ§ Ù…ØªØ¹Ø¯Ø¯Ø©</li>
                    <li><strong>Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ÙŠØ©:</strong> Ø­Ø¯Ø¯ Ø§Ù„Ø®Ù„Ø§ÙŠØ§ Ø«Ù… Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø£Ø²Ø±Ø§Ø± (Ø¬Ù…Ø¹ØŒ Ø·Ø±Ø­ØŒ Ø¶Ø±Ø¨ØŒ Ù‚Ø³Ù…Ø©)</li>
                    <li><strong>Ø¥Ø¶Ø§ÙØ© ØµÙ/Ø¹Ù…ÙˆØ¯:</strong> Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙÙŠ Ù‚Ø³Ù… "ØªØ±Ù‚ÙŠÙ… ÙˆÙ‡ÙŠÙƒÙ„Ø©"</li>
                </ul>
            </div>
            
            <div class="help-section">
                <h3>ğŸ–¼ï¸ Ø§Ù„ØµÙˆØ±</h3>
                <ul>
                    <li><strong>Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±Ø©:</strong> Ø§Ø¶ØºØ· Ø²Ø± "ØµÙˆØ±Ø©" ÙˆØ§Ø®ØªØ± Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</li>
                    <li><strong>ØªØ­Ø±ÙŠÙƒ Ø§Ù„ØµÙˆØ±Ø©:</strong> Ø§Ø¶ØºØ· ÙˆØ§Ø³Ø­Ø¨ Ø§Ù„ØµÙˆØ±Ø© Ù…Ø¨Ø§Ø´Ø±Ø©</li>
                    <li><strong>ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø¬Ù…:</strong> Ø§Ø³Ø­Ø¨ Ø§Ù„Ù…Ù‚Ø§Ø¨Ø¶ ÙÙŠ Ø§Ù„Ø²ÙˆØ§ÙŠØ§ Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø£Ø²Ø±Ø§Ø± (ØµØºÙŠØ±/Ø¹Ø§Ø¯ÙŠ/ÙƒØ¨ÙŠØ±)</li>
                    <li><strong>Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„ÙƒÙŠØ¨ÙˆØ±Ø¯:</strong> Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø£Ø³Ù‡Ù… Ù„ØªØ­Ø±ÙŠÙƒ Ø§Ù„ØµÙˆØ±Ø© (Shift Ù„Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø©)</li>
                    <li><strong>Ø§Ù„Ù…Ø­Ø§Ø°Ø§Ø©:</strong> Ø§Ø³ØªØ®Ø¯Ù… Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…Ø­Ø§Ø°Ø§Ø© (ÙŠØ³Ø§Ø±/ÙˆØ³Ø·/ÙŠÙ…ÙŠÙ†)</li>
                </ul>
            </div>
            
            <div class="help-section">
                <h3>ğŸ“ Ø§Ù„Ù†ØµÙˆØµ ÙˆØ§Ù„Ù…Ø­ØªÙˆÙ‰</h3>
                <ul>
                    <li><strong>Ø¥Ø¶Ø§ÙØ© Ø¹Ù†ÙˆØ§Ù†:</strong> Ø§Ø¶ØºØ· Ø²Ø± "H Ø¹Ù†ÙˆØ§Ù†"</li>
                    <li><strong>Ø¥Ø¶Ø§ÙØ© ÙÙ‚Ø±Ø©:</strong> Ø§Ø¶ØºØ· Ø²Ø± "ğŸ“ ÙÙ‚Ø±Ø©"</li>
                    <li><strong>Ø¥Ø¶Ø§ÙØ© ÙˆØµÙ:</strong> Ø§Ø¶ØºØ· Ø²Ø± "ğŸ“„ ÙˆØµÙ"</li>
                    <li><strong>Ø¥Ø¶Ø§ÙØ© Ø®Ø·:</strong> Ø§Ø¶ØºØ· Ø²Ø± "â– Ø®Ø·" Ù„Ø¥Ø¶Ø§ÙØ© Ø®Ø· ÙØ§ØµÙ„</li>
                    <li><strong>ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ù†ØµÙˆØµ:</strong> Ø§Ø¶ØºØ· ÙˆØ§Ø³Ø­Ø¨ Ø£ÙŠ Ù†Øµ (Ø¹Ù†ÙˆØ§Ù†ØŒ ÙÙ‚Ø±Ø©ØŒ ÙˆØµÙ) Ù„ØªØ­Ø±ÙŠÙƒÙ‡</li>
                    <li><strong>Ø­Ø°Ù Ø§Ù„Ù…Ø­ØªÙˆÙ‰:</strong> Ø§Ø¶ØºØ· Ø²Ø± X Ø§Ù„Ø°ÙŠ ÙŠØ¸Ù‡Ø± Ø¹Ù†Ø¯ Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø£Ùˆ Ø§Ù†Ù‚Ø± Ù†Ù‚Ø±Ø§Ù‹ Ù…Ø²Ø¯ÙˆØ¬Ø§Ù‹</li>
                    <li><strong>Ø§Ù„Ø¨ÙˆØ±Ø¯Ø±:</strong> Ø­Ø¯Ø¯ Ø§Ù„Ù†Øµ Ø«Ù… Ø§Ø¶ØºØ· "ğŸ”² Ø¨ÙˆØ±Ø¯Ø±" Ù„Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø¨ÙˆØ±Ø¯Ø±</li>
                </ul>
            </div>
            
            <div class="help-section">
                <h3>ğŸ“ Ø§Ù„Ù‡ÙˆØ§Ù…Ø´ ÙˆØ§Ù„Ø¨ÙˆØ±Ø¯Ø±</h3>
                <ul>
                    <li><strong>Ù‡ÙˆØ§Ù…Ø´ Ø§Ù„ØµÙØ­Ø©:</strong> Ø§Ø¶ØºØ· "ğŸ“ Ù‡ÙˆØ§Ù…Ø´" Ù„Ù„ØªØ­ÙƒÙ… ÙÙŠ Ù‡ÙˆØ§Ù…Ø´ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙØ­Ø§Øª</li>
                    <li><strong>Ø¨ÙˆØ±Ø¯Ø± Ø§Ù„Ù…Ø­ØªÙˆÙ‰:</strong> Ø­Ø¯Ø¯ Ø£ÙŠ Ù†Øµ Ø«Ù… Ø§Ø¶ØºØ· "ğŸ”² Ø¨ÙˆØ±Ø¯Ø±" Ù„Ù„ØªØ­ÙƒÙ… ÙÙŠ Ù†ÙˆØ¹ Ø§Ù„Ø¨ÙˆØ±Ø¯Ø±ØŒ Ø§Ù„Ø³Ù…ÙƒØŒ ÙˆØ§Ù„Ù„ÙˆÙ†</li>
                    <li><strong>Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø¨ÙˆØ±Ø¯Ø±:</strong> Ø®Ø·ØŒ Ù…ØªÙ‚Ø·Ø¹ØŒ Ù†Ù‚Ø·ØŒ Ù…Ø²Ø¯ÙˆØ¬ØŒ Ø£Ùˆ Ø¨Ø¯ÙˆÙ†</li>
                </ul>
            </div>
            
            <div class="help-section">
                <h3>ğŸ”¢ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ÙŠØ©</h3>
                <ul>
                    <li><strong>Ø§Ù„Ø¬Ù…Ø¹:</strong> Ø­Ø¯Ø¯ Ø§Ù„Ø®Ù„Ø§ÙŠØ§ ÙˆØ§Ø¶ØºØ· "âˆ‘ Ù…Ø¬Ù…ÙˆØ¹"</li>
                    <li><strong>Ø§Ù„Ø·Ø±Ø­:</strong> Ø­Ø¯Ø¯ Ø§Ù„Ø®Ù„Ø§ÙŠØ§ ÙˆØ§Ø¶ØºØ· "â– Ø·Ø±Ø­"</li>
                    <li><strong>Ø§Ù„Ø¶Ø±Ø¨:</strong> Ø­Ø¯Ø¯ Ø§Ù„Ø®Ù„Ø§ÙŠØ§ ÙˆØ§Ø¶ØºØ· "âœ–ï¸ Ø¶Ø±Ø¨"</li>
                    <li><strong>Ø§Ù„Ù‚Ø³Ù…Ø©:</strong> Ø­Ø¯Ø¯ Ø§Ù„Ø®Ù„Ø§ÙŠØ§ ÙˆØ§Ø¶ØºØ· "â— Ù‚Ø³Ù…Ø©"</li>
                    <li><strong>Ø¥Ø¯Ø±Ø§Ø¬ Ø§Ù„Ù†Ø§ØªØ¬:</strong> Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø®Ù„ÙŠØ© Ø«Ù… Ø§Ø³ØªØ®Ø¯Ù… "ğŸ“ Ø¥Ø¯Ø±Ø§Ø¬ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹"</li>
                </ul>
            </div>
            
            <div class="help-section">
                <h3>ğŸ’¾ Ø§Ù„Ø­ÙØ¸ ÙˆØ§Ù„ØªØµØ¯ÙŠØ±</h3>
                <ul>
                    <li><strong>Ø­ÙØ¸:</strong> Ø§Ø¶ØºØ· "ğŸ’¾ Ø­ÙØ¸" Ù„Ø­ÙØ¸ Ø§Ù„Ù…Ø³ØªÙ†Ø¯ ÙƒÙ…Ù„Ù JSON</li>
                    <li><strong>ØªØµØ¯ÙŠØ± PDF:</strong> Ø§Ø¶ØºØ· "ğŸ“¥ ØªØµØ¯ÙŠØ±" Ø«Ù… Ø§Ø®ØªØ± "PDF" Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªÙ†Ø¯ ÙƒÙ…Ù„Ù PDF</li>
                    <li><strong>ØªØµØ¯ÙŠØ± PNG:</strong> Ø§Ø¶ØºØ· "ğŸ“¥ ØªØµØ¯ÙŠØ±" Ø«Ù… Ø§Ø®ØªØ± "PNG" Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªÙ†Ø¯ ÙƒØµÙˆØ±Ø© PNG</li>
                    <li><strong>Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©:</strong> Ø§Ø¶ØºØ· Ø²Ø± "ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©" ÙÙŠ Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø©</li>
                </ul>
            </div>
        </div>
    </div>
    
    <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØµØ¯ÙŠØ± -->
    <div class="export-menu" id="exportMenu">
        <button class="export-close" onclick="closeExportMenu()">âœ•</button>
        <h3>ğŸ“¥ ØªØµØ¯ÙŠØ± Ø§Ù„Ù…Ø³ØªÙ†Ø¯</h3>
        <div class="export-options">
            <button class="export-btn pdf" onclick="exportToPDF()">
                ğŸ“„ ØªØµØ¯ÙŠØ± ÙƒÙ€ PDF
            </button>
            <button class="export-btn png" onclick="exportToPNG()">
                ğŸ–¼ï¸ ØªØµØ¯ÙŠØ± ÙƒÙ€ PNG
            </button>
        </div>
    </div>
    
    <!-- Workspace -->
    <div class="workspace" id="workspace">
        <div class="page-container" id="page1">
            <div class="page-header">
                <span>ØµÙØ­Ø© 1</span>
                <div style="display:flex; gap:5px;">
                    <button onclick="printThisPage('page1')" class="primary-btn" style="padding:2px 8px; font-size:11px;">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
                    <button onclick="deletePage('page1')" class="danger-btn" style="padding:2px 8px; font-size:11px;" title="Ø­Ø°Ù Ø§Ù„ØµÙØ­Ø©">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                </div>
            </div>
            <div class="a4-page">
                <div class="page-content">
                    <!-- Ø§Ù„ØµÙØ­Ø© Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø¹Ù…Ù„ -->
                </div>
                <div class="page-footer">
                    <div class="company-name">SIGMA SHOES EG</div>
                    <div class="company-info">Ø´Ø±ÙƒØ© Ø³ÙŠØ¬Ù…Ø§ Ù„Ù„Ø£Ø­Ø°ÙŠØ© - Ù…ØµØ±</div>
                    <div class="company-info">Sigma Shoes Company - Egypt</div>
                    <div class="print-date" id="printDate1"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===============================================
        // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ¯ ÙˆØ§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù†Ø´Ø·
        // ===============================================
        let selectedCells = [];
        let activeTable = null;
        let lastClickedCell = null; // Ù„ØªØ­Ø¯ÙŠØ¯ Ø£ÙŠÙ† Ù†ÙƒØªØ¨ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹
        let selectedImage = null; // Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
        let selectedBlock = null; // Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ø­Ø¯Ø¯
        let isDragging = false; // Ø­Ø§Ù„Ø© Ø§Ù„Ø³Ø­Ø¨
        let dragOffset = { x: 0, y: 0 }; // Ø¥Ø²Ø§Ø­Ø© Ø§Ù„Ø³Ø­Ø¨

        document.addEventListener('click', function(e) {
            // Ù…Ù†Ø¹ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± X
            if (e.target.classList.contains('mini-btn') || e.target.closest('.mini-btn')) {
                e.stopPropagation();
                return;
            }
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ ØµÙˆØ±Ø©
            const imgWrapper = e.target.closest('.resizable-img-wrapper');
            if (imgWrapper && !e.target.closest('.img-controls') && !e.target.closest('.img-margin-controls')) {
                document.querySelectorAll('.selected-img').forEach(img => img.classList.remove('selected-img'));
                imgWrapper.classList.add('selected-img');
                selectedImage = imgWrapper;
                // Ø¥Ù„ØºØ§Ø¡ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¢Ø®Ø±
                document.querySelectorAll('.selected-block').forEach(block => block.classList.remove('selected-block'));
                selectedBlock = null;
                return;
            }
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ù…Ø­ØªÙˆÙ‰ Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„
            const block = e.target.closest('.editable-block');
            if (block && !e.target.closest('.resizable-img-wrapper')) {
                document.querySelectorAll('.selected-block').forEach(b => b.classList.remove('selected-block'));
                block.classList.add('selected-block');
                selectedBlock = block;
                // Ø¥Ù„ØºØ§Ø¡ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ØµÙˆØ±
                document.querySelectorAll('.selected-img').forEach(img => img.classList.remove('selected-img'));
                selectedImage = null;
            }
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø®Ù„ÙŠØ©
            const cell = e.target.closest('td, th');
            if (!cell) {
                // Ø¥Ù„ØºØ§Ø¡ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ØµÙˆØ± Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
                if (!e.target.closest('.resizable-img-wrapper') && !e.target.closest('.img-controls') && !e.target.closest('.img-margin-controls')) {
                    document.querySelectorAll('.selected-img').forEach(img => img.classList.remove('selected-img'));
                    selectedImage = null;
                }
                return;
            }
            
            activeTable = cell.closest('table');
            lastClickedCell = cell;

            if (e.ctrlKey || e.metaKey) {
                if (selectedCells.includes(cell)) {
                    cell.classList.remove('selected');
                    selectedCells = selectedCells.filter(c => c !== cell);
                } else {
                    cell.classList.add('selected');
                    selectedCells.push(cell);
                }
            } else {
                document.querySelectorAll('.selected').forEach(c => c.classList.remove('selected'));
                selectedCells = [cell];
                cell.classList.add('selected');
            }
        });
        
        // ===============================================
        // Drag & Drop Ù„Ù„ØµÙˆØ± (Ù…Ø­Ø³Ù‘Ù†)
        // ===============================================
        document.addEventListener('mousedown', function(e) {
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØµÙˆØ± - ÙÙ‚Ø· Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ù…Ø¨Ø§Ø´Ø±Ø© Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØ±Ø© (ÙˆÙ„ÙŠØ³ Ø¹Ù„Ù‰ Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ­ÙƒÙ…)
            const imgWrapper = e.target.closest('.resizable-img-wrapper');
            if (imgWrapper) {
                // Ù…Ù†Ø¹ Ø§Ù„Ø³Ø­Ø¨ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ­ÙƒÙ… Ø£Ùˆ Ø§Ù„Ù…Ù‚Ø§Ø¨Ø¶
                if (e.target.closest('.img-handle') || 
                    e.target.closest('.img-controls') || 
                    e.target.closest('.img-margin-controls') ||
                    e.target.tagName === 'INPUT') {
                    return;
                }
                
                // Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø³Ø­Ø¨ ÙÙ‚Ø· Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ù…Ø¨Ø§Ø´Ø±Ø© Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØ±Ø©
                if (e.target.tagName === 'IMG' || e.target === imgWrapper) {
                    isDragging = true;
                    const rect = imgWrapper.getBoundingClientRect();
                    const pageRect = imgWrapper.closest('.a4-page').getBoundingClientRect();
                    
                    dragOffset.x = e.clientX - rect.left;
                    dragOffset.y = e.clientY - rect.top;
                    
                    imgWrapper.classList.add('dragging');
                    imgWrapper.style.cursor = 'grabbing';
                    
                    // Ø¥Ø®ÙØ§Ø¡ Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ­ÙƒÙ… Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø³Ø­Ø¨
                    const controls = imgWrapper.querySelector('.img-controls');
                    const margins = imgWrapper.querySelector('.img-margin-controls');
                    if(controls) controls.style.display = 'none';
                    if(margins) margins.style.display = 'none';
                    
                    e.preventDefault();
                    e.stopPropagation();
                    return;
                }
            }
            
            // Drag & Drop Ù„Ù„Ø¬Ø¯Ø§ÙˆÙ„
            const tableBlock = e.target.closest('.draggable-table');
            if (tableBlock && !e.target.closest('td, th') && !e.target.closest('.block-tools') && !e.target.closest('.border-controls')) {
                isDragging = true;
                const rect = tableBlock.getBoundingClientRect();
                const pageRect = tableBlock.closest('.a4-page').getBoundingClientRect();
                
                dragOffset.x = e.clientX - rect.left;
                dragOffset.y = e.clientY - rect.top;
                
                tableBlock.classList.add('dragging');
                tableBlock.style.cursor = 'grabbing';
                
                e.preventDefault();
            }
            
            // Drag & Drop Ù„Ù„Ù†ØµÙˆØµ
            const textBlock = e.target.closest('.draggable-text');
            if (textBlock && !e.target.closest('.block-tools') && !e.target.closest('.border-controls')) {
                // Ù…Ù†Ø¹ Ø§Ù„Ø³Ø­Ø¨ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠØ­Ø±Ø± Ø§Ù„Ù†Øµ
                if (document.activeElement === e.target || textBlock.querySelector(':focus')) {
                    return;
                }
                
                isDragging = true;
                const rect = textBlock.getBoundingClientRect();
                const pageRect = textBlock.closest('.a4-page').getBoundingClientRect();
                
                dragOffset.x = e.clientX - rect.left;
                dragOffset.y = e.clientY - rect.top;
                
                textBlock.classList.add('dragging');
                textBlock.style.cursor = 'grabbing';
                
                e.preventDefault();
            }
        });
        
        document.addEventListener('mousemove', function(e) {
            if (!isDragging) return;
            
            // ØªØ­Ø±ÙŠÙƒ Ø§Ù„ØµÙˆØ±
            if (selectedImage) {
                const page = selectedImage.closest('.a4-page');
                if (!page) return;
                
                const pageRect = page.getBoundingClientRect();
                const newX = e.clientX - pageRect.left - dragOffset.x;
                const newY = e.clientY - pageRect.top - dragOffset.y;
                
                // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„ØµÙˆØ±Ø© Ø¯Ø§Ø®Ù„ Ø­Ø¯ÙˆØ¯ Ø§Ù„ØµÙØ­Ø©
                const imgWidth = selectedImage.offsetWidth;
                const imgHeight = selectedImage.offsetHeight;
                const maxX = page.offsetWidth - imgWidth;
                const maxY = page.offsetHeight - imgHeight;
                
                selectedImage.style.left = Math.max(0, Math.min(newX, maxX)) + 'px';
                selectedImage.style.top = Math.max(0, Math.min(newY, maxY)) + 'px';
            }
            
            // ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„
            const draggingTable = document.querySelector('.draggable-table.dragging');
            if (draggingTable) {
                const page = draggingTable.closest('.a4-page');
                if (!page) return;
                
                const pageRect = page.getBoundingClientRect();
                const newX = e.clientX - pageRect.left - dragOffset.x;
                const newY = e.clientY - pageRect.top - dragOffset.y;
                
                const tableWidth = draggingTable.offsetWidth;
                const tableHeight = draggingTable.offsetHeight;
                const maxX = page.offsetWidth - tableWidth;
                const maxY = page.offsetHeight - tableHeight;
                
                draggingTable.style.position = 'absolute';
                draggingTable.style.left = Math.max(0, Math.min(newX, maxX)) + 'px';
                draggingTable.style.top = Math.max(0, Math.min(newY, maxY)) + 'px';
            }
            
            // ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ù†ØµÙˆØµ
            const draggingText = document.querySelector('.draggable-text.dragging');
            if (draggingText) {
                const page = draggingText.closest('.a4-page');
                if (!page) return;
                
                const pageRect = page.getBoundingClientRect();
                const newX = e.clientX - pageRect.left - dragOffset.x;
                const newY = e.clientY - pageRect.top - dragOffset.y;
                
                const textWidth = draggingText.offsetWidth;
                const textHeight = draggingText.offsetHeight;
                const maxX = page.offsetWidth - textWidth;
                const maxY = page.offsetHeight - textHeight;
                
                draggingText.style.position = 'absolute';
                draggingText.style.left = Math.max(0, Math.min(newX, maxX)) + 'px';
                draggingText.style.top = Math.max(0, Math.min(newY, maxY)) + 'px';
            }
        });
        
        document.addEventListener('mouseup', function() {
            if (isDragging) {
                if (selectedImage) {
                    selectedImage.classList.remove('dragging');
                    selectedImage.style.cursor = 'move';
                }
                const draggingTable = document.querySelector('.draggable-table.dragging');
                if (draggingTable) {
                    draggingTable.classList.remove('dragging');
                    draggingTable.style.cursor = 'move';
                }
                const draggingText = document.querySelector('.draggable-text.dragging');
                if (draggingText) {
                    draggingText.classList.remove('dragging');
                    draggingText.style.cursor = 'move';
                }
            }
            isDragging = false;
        });
        
        // ===============================================
        // Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„ÙƒÙŠØ¨ÙˆØ±Ø¯ (Ø£Ø³Ù‡Ù…) Ù„ØªØ­Ø±ÙŠÙƒ Ø§Ù„ØµÙˆØ±
        // ===============================================
        document.addEventListener('keydown', function(e) {
            if (!selectedImage) return;
            
            const step = e.shiftKey ? 10 : 1; // Shift Ù„Ù„ØªØ­Ø±Ùƒ Ø¨Ø®Ø·ÙˆØ§Øª Ø£ÙƒØ¨Ø±
            const page = selectedImage.closest('.a4-page');
            if (!page) return;
            
            let currentLeft = parseInt(selectedImage.style.left) || 0;
            let currentTop = parseInt(selectedImage.style.top) || 0;
            const imgWidth = selectedImage.offsetWidth;
            const imgHeight = selectedImage.offsetHeight;
            const maxX = page.offsetWidth - imgWidth;
            const maxY = page.offsetHeight - imgHeight;
            
            switch(e.key) {
                case 'ArrowRight':
                    e.preventDefault();
                    currentLeft = Math.min(currentLeft + step, maxX);
                    selectedImage.style.left = currentLeft + 'px';
                    break;
                case 'ArrowLeft':
                    e.preventDefault();
                    currentLeft = Math.max(currentLeft - step, 0);
                    selectedImage.style.left = currentLeft + 'px';
                    break;
                case 'ArrowDown':
                    e.preventDefault();
                    currentTop = Math.min(currentTop + step, maxY);
                    selectedImage.style.top = currentTop + 'px';
                    break;
                case 'ArrowUp':
                    e.preventDefault();
                    currentTop = Math.max(currentTop - step, 0);
                    selectedImage.style.top = currentTop + 'px';
                    break;
                case 'Delete':
                case 'Backspace':
                    if (selectedImage && !e.target.contentEditable) {
                        e.preventDefault();
                        deleteSelectedImage();
                    }
                    break;
            }
        });
        
        // ===============================================
        // Drag & Drop Ù…Ù† Ø§Ù„Ù…Ù„ÙØ§Øª
        // ===============================================
        document.addEventListener('dragover', function(e) {
            e.preventDefault();
            const page = e.target.closest('.a4-page');
            if (page) {
                page.classList.add('drag-over');
            }
        });
        
        document.addEventListener('dragleave', function(e) {
            const page = e.target.closest('.a4-page');
            if (page) {
                page.classList.remove('drag-over');
            }
        });
        
        document.addEventListener('drop', function(e) {
            e.preventDefault();
            const page = e.target.closest('.a4-page');
            if (page) {
                page.classList.remove('drag-over');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    Array.from(files).forEach(file => {
                        if (file.type.startsWith('image/')) {
                            const reader = new FileReader();
                            reader.onload = function(event) {
                                const d = document.createElement('div');
                                d.className = 'editable-block';
                                d.style.textAlign = 'center';
                                d.style.position = 'relative';
                                
                                const rect = page.getBoundingClientRect();
                                const x = e.clientX - rect.left;
                                const y = e.clientY - rect.top;
                                
                                d.innerHTML = `<div class="block-tools"><button class="mini-btn danger-btn" onclick="deleteBlock(this)">X</button></div>
                                    <div class="resizable-img-wrapper selected-img" style="left:${x}px; top:${y}px; width:200px;">
                                        <img src="${event.target.result}">
                                        <div class="img-handle bottom-right"></div>
                                        <div class="img-handle bottom-left"></div>
                                        <div class="img-handle top-right"></div>
                                        <div class="img-handle top-left"></div>
                                        <div class="img-controls">
                                            <button onclick="resizeImage(50)" title="ØªØµØºÙŠØ±">ğŸ”½</button>
                                            <button onclick="resizeImage(100)" title="Ø¹Ø§Ø¯ÙŠ">â¹ï¸</button>
                                            <button onclick="resizeImage(150)" title="ØªÙƒØ¨ÙŠØ±">ğŸ”¼</button>
                                            <button onclick="alignImage('left')">â¬…ï¸</button>
                                            <button onclick="alignImage('center')">âºï¸</button>
                                            <button onclick="alignImage('right')">â¡ï¸</button>
                                            <button class="danger-btn" onclick="deleteBlock(this)">ğŸ—‘ï¸</button>
                                        </div>
                                        <div class="img-margin-controls">
                                            <div class="margin-input-group">
                                                <label>Ù‡Ø§Ù…Ø´ Ø¹Ù„ÙˆÙŠ:</label>
                                                <input type="number" id="marginTop" value="0" min="0" onchange="applyImageMargin('top', this.value)">
                                            </div>
                                            <div class="margin-input-group">
                                                <label>Ù‡Ø§Ù…Ø´ Ø³ÙÙ„ÙŠ:</label>
                                                <input type="number" id="marginBottom" value="0" min="0" onchange="applyImageMargin('bottom', this.value)">
                                            </div>
                                            <div class="margin-input-group">
                                                <label>Ù‡Ø§Ù…Ø´ Ø£ÙŠÙ…Ù†:</label>
                                                <input type="number" id="marginRight" value="0" min="0" onchange="applyImageMargin('right', this.value)">
                                            </div>
                                            <div class="margin-input-group">
                                                <label>Ù‡Ø§Ù…Ø´ Ø£ÙŠØ³Ø±:</label>
                                                <input type="number" id="marginLeft" value="0" min="0" onchange="applyImageMargin('left', this.value)">
                                            </div>
                                            <div class="margin-input-group">
                                                <label>Padding Ø¹Ù„ÙˆÙŠ:</label>
                                                <input type="number" id="paddingTop" value="0" min="0" onchange="applyImagePadding('top', this.value)">
                                            </div>
                                            <div class="margin-input-group">
                                                <label>Padding Ø³ÙÙ„ÙŠ:</label>
                                                <input type="number" id="paddingBottom" value="0" min="0" onchange="applyImagePadding('bottom', this.value)">
                                            </div>
                                            <div class="margin-input-group">
                                                <label>Padding Ø£ÙŠÙ…Ù†:</label>
                                                <input type="number" id="paddingRight" value="0" min="0" onchange="applyImagePadding('right', this.value)">
                                            </div>
                                            <div class="margin-input-group">
                                                <label>Padding Ø£ÙŠØ³Ø±:</label>
                                                <input type="number" id="paddingLeft" value="0" min="0" onchange="applyImagePadding('left', this.value)">
                                            </div>
                                        </div>
                                    </div>`;
                                page.appendChild(d);
                                
                                const wrapper = d.querySelector('.resizable-img-wrapper');
                                selectedImage = wrapper;
                                setupImageHandlers(wrapper);
                            };
                            reader.readAsDataURL(file);
                        }
                    });
                }
            }
        });

        // ===============================================
        // Ø§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„Ø­Ø³Ø§Ø¨ÙŠ (Calculation Logic)
        // ===============================================
        
        // 1. Ø­Ø³Ø§Ø¨ Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù…Ø­Ø¯Ø¯ (Alert Ø£Ùˆ Insert)
        function calcSum(mode) {
            if (selectedCells.length < 1) return alert('Ø­Ø¯Ø¯ Ø§Ù„Ø®Ù„Ø§ÙŠØ§ Ø§Ù„ØªÙŠ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø£Ø±Ù‚Ø§Ù… Ø£ÙˆÙ„Ø§Ù‹.');

            let sum = 0;
            let count = 0;
            selectedCells.forEach(c => {
                // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø±Ù‚Ù… Ø­ØªÙ‰ Ù„Ùˆ ÙƒØ§Ù† Ø¨Ø¬Ø§Ù†Ø¨Ù‡ Ù†Øµ (Ù…Ø«Ù„ 500 Ø¬.Ù…)
                const text = c.innerText.replace(/[^\d.-]/g, '');
                const val = parseFloat(text);
                if (!isNaN(val)) {
                    sum += val;
                    count++;
                }
            });

            if (count === 0) return alert('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£Ø±Ù‚Ø§Ù… ÙÙŠ Ø§Ù„Ø®Ù„Ø§ÙŠØ§ Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©.');

            if (mode === 'alert') {
                alert(`Ù…Ø¬Ù…ÙˆØ¹ ${count} Ø®Ù„Ø§ÙŠØ§ Ù‡Ùˆ: ${sum}`);
            } else if (mode === 'insert') {
                // Ø§Ù„ÙƒØªØ§Ø¨Ø© ÙÙŠ Ø¢Ø®Ø± Ø®Ù„ÙŠØ© ØªÙ… Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„ÙŠÙ‡Ø§ (ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø®Ø§Ø±Ø¬ Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ù„ØªØ¬Ù†Ø¨ Ø§Ù„ÙƒØªØ§Ø¨Ø© ÙÙˆÙ‚ Ø§Ù„Ø±Ù‚Ù…)
                if (lastClickedCell) {
                    lastClickedCell.innerText = sum;
                    // ØªÙ„ÙˆÙŠÙ† Ø®ÙÙŠÙ Ù„ØªÙ…ÙŠÙŠØ² Ø§Ù„Ù†Ø§ØªØ¬
                    lastClickedCell.style.fontWeight = 'bold';
                    lastClickedCell.style.backgroundColor = '#e8f5e9';
                } else {
                    alert('Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø®Ù„ÙŠØ© Ø§Ù„ØªÙŠ ØªØ±ÙŠØ¯ ÙˆØ¶Ø¹ Ø§Ù„Ù†Ø§ØªØ¬ ÙÙŠÙ‡Ø§ Ø£ÙˆÙ„Ø§Ù‹.');
                }
            }
        }
        
        // Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ÙŠØ© Ø§Ù„Ø£Ø®Ø±Ù‰ (Ø·Ø±Ø­ØŒ Ø¶Ø±Ø¨ØŒ Ù‚Ø³Ù…Ø©)
        function calcOperation(operation) {
            if (selectedCells.length < 2) return alert('Ø­Ø¯Ø¯ Ø®Ù„ÙŠØªÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©.');
            
            const values = [];
            selectedCells.forEach(c => {
                const text = c.innerText.replace(/[^\d.-]/g, '');
                const val = parseFloat(text);
                if (!isNaN(val)) {
                    values.push(val);
                }
            });
            
            if (values.length < 2) return alert('ÙŠØ¬Ø¨ Ø£Ù† ØªØ­ØªÙˆÙŠ Ø§Ù„Ø®Ù„Ø§ÙŠØ§ Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© Ø¹Ù„Ù‰ Ø£Ø±Ù‚Ø§Ù… ØµØ­ÙŠØ­Ø©.');
            
            let result;
            switch(operation) {
                case 'subtract':
                    result = values[0];
                    for(let i = 1; i < values.length; i++) {
                        result -= values[i];
                    }
                    break;
                case 'multiply':
                    result = values[0];
                    for(let i = 1; i < values.length; i++) {
                        result *= values[i];
                    }
                    break;
                case 'divide':
                    result = values[0];
                    for(let i = 1; i < values.length; i++) {
                        if(values[i] === 0) return alert('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ù‚Ø³Ù…Ø© Ø¹Ù„Ù‰ ØµÙØ±!');
                        result /= values[i];
                    }
                    break;
            }
            
            if (lastClickedCell) {
                lastClickedCell.innerText = result.toFixed(2);
                lastClickedCell.style.fontWeight = 'bold';
                lastClickedCell.style.backgroundColor = '#e8f5e9';
            } else {
                alert(`Ø§Ù„Ù†Ø§ØªØ¬: ${result.toFixed(2)}`);
            }
        }

        // 2. Ø¥Ø¶Ø§ÙØ© ØµÙ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
        function addTotalRow() {
            if (!activeTable) return alert('Ø­Ø¯Ø¯ Ø¬Ø¯ÙˆÙ„Ø§Ù‹ Ø£ÙˆÙ„Ø§Ù‹.');

            const row = activeTable.insertRow(-1); // ØµÙ ÙÙŠ Ø§Ù„Ù†Ù‡Ø§ÙŠØ©
            row.style.fontWeight = 'bold';
            row.style.backgroundColor = '#eee';

            const colCount = activeTable.rows[0].cells.length;

            // Ø§Ù„ØªÙƒØ±Ø§Ø± Ø¹Ù„Ù‰ ÙƒÙ„ Ø¹Ù…ÙˆØ¯
            for (let i = 0; i < colCount; i++) {
                const newCell = row.insertCell(i);
                newCell.style.border = '1px solid #999';
                newCell.contentEditable = true;

                // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¬Ù…Ø¹ Ø§Ù„Ø¹Ù…ÙˆØ¯
                let colSum = 0;
                let hasNumbers = false;
                
                // Ù†Ø¬Ù…Ø¹ ÙƒÙ„ Ø§Ù„ØµÙÙˆÙ Ù…Ø§ Ø¹Ø¯Ø§ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† ÙˆØ§Ù„ØµÙ Ø§Ù„Ø¬Ø¯ÙŠØ¯
                for (let r = 1; r < activeTable.rows.length - 1; r++) {
                    const cell = activeTable.rows[r].cells[i];
                    if (cell) {
                        const val = parseFloat(cell.innerText.replace(/[^\d.-]/g, ''));
                        if (!isNaN(val)) {
                            colSum += val;
                            hasNumbers = true;
                        }
                    }
                }

                if (hasNumbers) {
                    newCell.innerText = colSum;
                } else if (i === 0) {
                    newCell.innerText = 'Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ'; // ÙƒØªØ§Ø¨Ø© ÙƒÙ„Ù…Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ ÙÙŠ Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø£ÙˆÙ„ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ø¨Ù‡ Ø£Ø±Ù‚Ø§Ù…
                }
            }
        }

        // ===============================================
        // Ø§Ù„ØªØ±Ù‚ÙŠÙ… ÙˆØ¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ±Ù‚ÙŠÙ…
        // ===============================================
        function autoNumber() {
            if(!activeTable) return alert('Ø­Ø¯Ø¯ Ø¬Ø¯ÙˆÙ„Ø§Ù‹.');
            let idx = -1;
            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø¹Ù…ÙˆØ¯ Ù…ÙˆØ¬ÙˆØ¯
            activeTable.querySelectorAll('th').forEach((th,i)=> { if(th.innerText.match(/Ù…|#/)) idx=i; });
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù…ÙˆØ¯ Ø¬Ø¯ÙŠØ¯
            if(idx===-1) {
                for(let r of activeTable.rows) {
                    let c = r.insertCell(0);
                    if(r.rowIndex===0) c.outerHTML='<th style="width:40px">Ù…</th>';
                    else { c.style.textAlign='center'; c.style.fontWeight='bold'; c.contentEditable=true; c.style.border='1px solid #999'; }
                }
                idx=0; setTimeout(()=>initResizers(activeTable),50);
            }
            
            // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø£Ø±Ù‚Ø§Ù…
            let n=1;
            for(let i=1; i<activeTable.rows.length; i++) {
                if(activeTable.rows[i].cells[idx]) activeTable.rows[i].cells[idx].innerText = n++;
            }
        }

        function removeNumbering() {
            if(!activeTable) return alert('Ø­Ø¯Ø¯ Ø¬Ø¯ÙˆÙ„Ø§Ù‹ Ù„Ø¥Ù„ØºØ§Ø¡ ØªØ±Ù‚ÙŠÙ…Ù‡.');
            let idx = -1;
            // Ø§Ù„Ø¨Ø­Ø« Ø¨Ø¯Ù‚Ø© Ø¹Ù† Ø¹Ù…ÙˆØ¯ Ø§Ù„ØªØ±Ù‚ÙŠÙ…
            activeTable.querySelectorAll('th').forEach((th,i)=> { 
                if(th.innerText.trim() === 'Ù…' || th.innerText.trim() === '#') idx=i; 
            });

            if (idx !== -1) {
                if(confirm('ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¹Ù…ÙˆØ¯ Ø§Ù„ØªØ±Ù‚ÙŠÙ…. Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°ÙÙ‡ØŸ')) {
                    for(let r of activeTable.rows) {
                        if(r.cells[idx]) r.deleteCell(idx);
                    }
                }
            } else {
                alert('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¹Ù…ÙˆØ¯ Ø¨Ø§Ø³Ù… "Ù…" Ø£Ùˆ "#". ÙŠÙ…ÙƒÙ†Ùƒ Ø­Ø°Ù Ø§Ù„Ø¹Ù…ÙˆØ¯ ÙŠØ¯ÙˆÙŠØ§Ù‹ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø²Ø± "Ø­Ø°Ù Ø¹Ù…ÙˆØ¯".');
            }
        }

        // ===============================================
        // Ø§Ù„Ø¯Ù…Ø¬ ÙˆØ§Ù„Ø£Ù„ÙˆØ§Ù† ÙˆØ§Ù„ØªÙ†Ø³ÙŠÙ‚ (Standard)
        // ===============================================
        function mergeCells() {
            if(selectedCells.length<2) return alert('Ø­Ø¯Ø¯ Ø®Ù„ÙŠØªÙŠÙ† Ø¨Ù€ Ctrl');
            const table = selectedCells[0].closest('table');
            if(!selectedCells.every(c=>c.closest('table')===table)) return;
            
            let minR=Infinity,maxR=-Infinity,minC=Infinity,maxC=-Infinity;
            selectedCells.forEach(c=>{
                minR=Math.min(minR,c.parentElement.rowIndex); maxR=Math.max(maxR,c.parentElement.rowIndex);
                minC=Math.min(minC,c.cellIndex); maxC=Math.max(maxC,c.cellIndex);
            });
            const target=selectedCells.find(c=>c.parentElement.rowIndex===minR && c.cellIndex===minC) || selectedCells[0];
            target.rowSpan = maxR-minR+1; target.colSpan = maxC-minC+1;
            selectedCells.forEach(c=> {if(c!==target) c.remove()});
            selectedCells=[target]; target.classList.add('selected');
        }

        function unmergeCells() {
            if(selectedCells.length!==1) return alert('Ø­Ø¯Ø¯ Ø®Ù„ÙŠØ© Ù…Ø¯Ù…ÙˆØ¬Ø©');
            const c=selectedCells[0]; const cs=c.colSpan;
            if(c.rowSpan===1 && cs===1) return;
            c.colSpan=1; c.rowSpan=1;
            for(let i=0; i<cs-1; i++) {
                let nc=c.parentElement.insertCell(c.cellIndex+1); nc.contentEditable=true; nc.style.border='1px solid #999';
            }
        }

        function applyColor(type, val) {
            if(selectedCells.length>0) selectedCells.forEach(c => c.style[type==='bg'?'backgroundColor':'color'] = val);
            else document.execCommand(type==='bg'?'hiliteColor':'foreColor', false, val);
        }

        function align(d) {
            if(activeTable) activeTable.style.textAlign=d;
            document.execCommand('justify'+(d==='right'?'Right':d==='left'?'Left':'Center'));
        }

        // ===============================================
        // Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© (Ø¬Ø¯Ø§ÙˆÙ„ØŒ ØµÙˆØ±ØŒ Ø·Ø¨Ø§Ø¹Ø©)
        // ===============================================
        // Ù…ØªØºÙŠØ± Ù„ØªØ®Ø²ÙŠÙ† Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ù…Ø±Ø§Ø¯ Ø¥Ø¶Ø§ÙØªÙ‡ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø±
        let pendingInsertType = null;
        
        // Ø¥Ø¶Ø§ÙØ© Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ù„Ù†Ù‚Ø± ÙÙŠ Ø£ÙŠ Ù…ÙƒØ§Ù† Ù„Ø¥Ø¶Ø§ÙØ© Ø¹Ù†ØµØ±
        function enableClickToInsert(type) {
            pendingInsertType = type;
            document.querySelectorAll('.page-content').forEach(content => {
                content.style.cursor = 'crosshair';
                content.title = 'Ø§Ù†Ù‚Ø± ÙÙŠ Ø§Ù„Ù…ÙƒØ§Ù† Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ù„Ø¥Ø¶Ø§ÙØ© ' + (type === 'divider' ? 'Ø®Ø·' : 'ØµÙˆØ±Ø©');
            });
        }
        
        // Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø§Ù„Ø¬ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ page-content
        document.addEventListener('DOMContentLoaded', function() {
            document.addEventListener('click', function(e) {
                const pageContent = e.target.closest('.page-content');
                if(pageContent && pendingInsertType) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    if(pendingInsertType === 'divider') {
                        addDividerAtPosition(pageContent, e);
                    } else if(pendingInsertType === 'image') {
                        // ÙØªØ­ Ù…Ù„Ù Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙˆØ±Ø©
                        document.getElementById('logoInput').click();
                        window.clickPositionForImage = { x: e.offsetX, y: e.offsetY, pageContent: pageContent };
                    }
                    
                    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
                    pendingInsertType = null;
                    document.querySelectorAll('.page-content').forEach(content => {
                        content.style.cursor = '';
                        content.title = '';
                    });
                }
            });
        });
        
        function addDividerAtPosition(pageContent, event) {
            const d = document.createElement('div');
            d.className = 'editable-block';
            d.style.margin = '10px 0';
            d.style.cursor = 'pointer';
            d.innerHTML = `<div class="block-tools"><button class="mini-btn danger-btn" onclick="deleteBlock(this)">X</button></div>
                <hr class="divider-line" onclick="deleteBlock(this.closest('.editable-block'))">`;
            
            // Ø¥Ø¯Ø±Ø§Ø¬ ÙÙŠ Ø§Ù„Ù…ÙƒØ§Ù† Ø§Ù„Ù…Ù†Ø§Ø³Ø¨
            const range = document.caretRangeFromPoint ? document.caretRangeFromPoint(event.clientX, event.clientY) : null;
            if(range) {
                const container = range.commonAncestorContainer;
                if(container.nodeType === Node.TEXT_NODE) {
                    container.parentNode.insertBefore(d, container);
                } else {
                    container.insertBefore(d, range.startContainer);
                }
            } else {
                // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ rangeØŒ Ø£Ø¶Ù ÙÙŠ Ù†Ù‡Ø§ÙŠØ© page-content
                pageContent.appendChild(d);
            }
        }
        
        function addBlock(type) {
            const p = document.querySelectorAll('.a4-page')[document.querySelectorAll('.a4-page').length-1];
            const pageContent = p.querySelector('.page-content') || p;
            const d = document.createElement('div'); d.className='editable-block';
            d.innerHTML = `<div class="block-tools"><button class="mini-btn danger-btn" onclick="deleteBlock(this)">X</button></div>`;
            if(type==='table') {
                createResizableTable(d);
                d.classList.add('draggable-table');
            } else if(type==='heading') {
                d.innerHTML+=`<h1 contenteditable="true" style="text-align:center; margin:10px 0;" onclick="deleteTextBlock(this, event)">Ø¹Ù†ÙˆØ§Ù†</h1>`;
                d.classList.add('deletable-text', 'draggable-text');
            } else if(type==='paragraph') {
                d.innerHTML+=`<p contenteditable="true" style="padding:10px; margin:5px 0; line-height:1.6;" onclick="deleteTextBlock(this, event)">ÙÙ‚Ø±Ø© Ù†ØµÙŠØ©...</p>`;
                d.classList.add('deletable-text', 'draggable-text');
            } else if(type==='description') {
                d.innerHTML+=`<div contenteditable="true" style="padding:15px; margin:10px 0; background:#f9f9f9; border-right:3px solid var(--primary); line-height:1.8;" onclick="deleteTextBlock(this, event)">ÙˆØµÙ ØªÙØµÙŠÙ„ÙŠ...</div>`;
                d.classList.add('deletable-text', 'draggable-text');
            } else if(type==='divider') {
                // ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„Ù†Ù‚Ø± Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø®Ø·
                enableClickToInsert('divider');
                return; // Ù„Ø§ Ù†Ø¶ÙŠÙ Ø§Ù„Ø®Ø· Ù…Ø¨Ø§Ø´Ø±Ø©ØŒ Ù†Ù†ØªØ¸Ø± Ø§Ù„Ù†Ù‚Ø±
            } else {
                d.innerHTML+=`<div contenteditable="true" style="padding:5px" onclick="deleteTextBlock(this, event)"><p>Ù†Øµ...</p></div>`;
                d.classList.add('deletable-text', 'draggable-text');
            }
            
            // Ø¥Ø¶Ø§ÙØ© Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø¨ÙˆØ±Ø¯Ø± ÙˆØ§Ù„Ø¹Ø±Ø¶
            if(type !== 'table' && type !== 'divider') {
                d.innerHTML += `<div class="border-controls">
                    <div class="border-input-group">
                        <label>Ù†ÙˆØ¹ Ø§Ù„Ø¨ÙˆØ±Ø¯Ø±:</label>
                        <select onchange="applyBorder('style', this.value)">
                            <option value="none">Ø¨Ø¯ÙˆÙ†</option>
                            <option value="solid">Ø®Ø·</option>
                            <option value="dashed">Ù…ØªÙ‚Ø·Ø¹</option>
                            <option value="dotted">Ù†Ù‚Ø·</option>
                            <option value="double">Ù…Ø²Ø¯ÙˆØ¬</option>
                        </select>
                    </div>
                    <div class="border-input-group">
                        <label>Ø³Ù…Ùƒ:</label>
                        <input type="number" min="0" max="20" value="1" onchange="applyBorder('width', this.value + 'px')">
                    </div>
                    <div class="border-input-group">
                        <label>Ù„ÙˆÙ†:</label>
                        <input type="color" value="#000000" onchange="applyBorder('color', this.value)">
                    </div>
                </div>`;
            }
            
            // Ø¥Ø¶Ø§ÙØ© Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø¹Ø±Ø¶ (Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ù…Ø§ Ø¹Ø¯Ø§ Ø§Ù„Ø®Ø·)
            if(type !== 'divider') {
                d.innerHTML += `<div class="width-controls">
                    <h4>ğŸ“ Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø¹Ø±Ø¶</h4>
                    <div class="width-preset-buttons">
                        <button class="width-preset-btn" onclick="setWidth('25%')">25%</button>
                        <button class="width-preset-btn" onclick="setWidth('50%')">50%</button>
                        <button class="width-preset-btn" onclick="setWidth('75%')">75%</button>
                        <button class="width-preset-btn" onclick="setWidth('100%')">100%</button>
                        <button class="width-preset-btn" onclick="setWidth('auto')">ØªÙ„Ù‚Ø§Ø¦ÙŠ</button>
                        <button class="width-preset-btn" onclick="setWidth('fit-content')">Ù…Ù„Ø§Ø¦Ù…</button>
                    </div>
                    <div class="border-input-group">
                        <label>Ø¹Ø±Ø¶ Ù…Ø®ØµØµ:</label>
                        <input type="text" id="customWidth" placeholder="Ù…Ø«Ø§Ù„: 300px Ø£Ùˆ 50%" onkeypress="if(event.key==='Enter') setCustomWidth()">
                    </div>
                    <div class="border-input-group">
                        <label>Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰:</label>
                        <input type="text" id="minWidth" placeholder="Ù…Ø«Ø§Ù„: 200px" onkeypress="if(event.key==='Enter') setMinWidth()">
                    </div>
                    <div class="border-input-group">
                        <label>Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰:</label>
                        <input type="text" id="maxWidth" placeholder="Ù…Ø«Ø§Ù„: 600px" onkeypress="if(event.key==='Enter') setMaxWidth()">
                    </div>
                    <div class="border-input-group">
                        <label>Ù†Ù…Ø· Ø§Ù„Ø¹Ø±Ø¶:</label>
                        <select onchange="setDisplayMode(this.value)">
                            <option value="block">Block (ÙƒØ§Ù…Ù„ Ø§Ù„Ø¹Ø±Ø¶)</option>
                            <option value="inline-block">Inline-Block (Ø¨Ø¬Ø§Ù†Ø¨ Ø¨Ø¹Ø¶)</option>
                            <option value="flex">Flex (Ù…Ø±Ù†)</option>
                        </select>
                    </div>
                </div>`;
            }
            
            pageContent.appendChild(d);
            // Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø³ÙƒØ±ÙˆÙ„ - Ø§Ø³ØªØ®Ø¯Ø§Ù… scrollIntoView Ù…Ø¹ Ø®ÙŠØ§Ø±Ø§Øª Ø£ÙØ¶Ù„
            setTimeout(() => {
                d.scrollIntoView({behavior:'smooth', block:'nearest', inline:'nearest'});
            }, 100);
        }

        function createResizableTable(c) {
            const t = document.createElement('table');
            t.innerHTML = `<thead><tr><th style="width:50px">Ù…</th><th>Ø§Ù„Ø¨ÙŠØ§Ù†</th><th>Ø§Ù„Ø³Ø¹Ø±</th></tr></thead><tbody><tr><td>1</td><td></td><td></td></tr></tbody>`;
            t.querySelectorAll('td, th').forEach(cell=>cell.contentEditable=true); 
            c.appendChild(t); 
            initResizers(t);
            // Ø¬Ø¹Ù„ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù‚Ø§Ø¨Ù„ Ù„Ù„Ø³Ø­Ø¨
            c.classList.add('draggable-table');
        }
        function initResizers(t) {
            t.querySelectorAll('th').forEach(th=>{
                if(th.querySelector('.resizer')) return;
                const r=document.createElement('div'); r.className='resizer'; r.contentEditable=false; th.appendChild(r);
                let x=0,w=0; r.addEventListener('mousedown',e=>{x=e.clientX; w=parseInt(getComputedStyle(th).width); document.addEventListener('mousemove',mm); document.addEventListener('mouseup',mu);});
                const mm=e=>th.style.width=(w-(x-e.clientX))+'px'; const mu=()=>{document.removeEventListener('mousemove',mm); document.removeEventListener('mouseup',mu);}
            });
        }
        function execTable(a) {
            if(!activeTable) return alert('Ø­Ø¯Ø¯ Ø¬Ø¯ÙˆÙ„Ø§Ù‹');
            if(a==='addrow') { 
                let r=activeTable.insertRow(-1); 
                for(let i=0;i<activeTable.rows[0].cells.length;i++){
                    let c=r.insertCell(); 
                    c.contentEditable=true; 
                    c.style.border='1px solid #999';
                } 
            }
            if(a==='addcol') { 
                for(let r of activeTable.rows){
                    let c=r.insertCell(-1); 
                    c.contentEditable=true; 
                    c.style.border='1px solid #999'; 
                    if(r.rowIndex===0){
                        c.outerHTML='<th>Ø¬Ø¯ÙŠØ¯</th>'; 
                        setTimeout(()=>initResizers(activeTable),50);
                    }
                } 
            }
            if(a==='delrow') {
                if(selectedCells.length > 0) {
                    const row = selectedCells[0].parentElement;
                    if(row.rowIndex === 0) return alert('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­Ø°Ù ØµÙ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†');
                    if(confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØµÙØŸ')) row.remove();
                } else {
                    alert('Ø­Ø¯Ø¯ Ø®Ù„ÙŠØ© ÙÙŠ Ø§Ù„ØµÙ Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯ Ø­Ø°ÙÙ‡');
                }
            }
            if(a==='delcol') {
                if(selectedCells.length > 0) {
                    const idx = selectedCells[0].cellIndex;
                    if(activeTable.rows[0].cells.length <= 1) return alert('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­Ø°Ù Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø£Ø®ÙŠØ±');
                    if(confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù…ÙˆØ¯ØŸ')) {
                        for(let r of activeTable.rows) {
                            if(r.cells[idx]) r.deleteCell(idx);
                        }
                        setTimeout(()=>initResizers(activeTable),50);
                    }
                } else {
                    alert('Ø­Ø¯Ø¯ Ø®Ù„ÙŠØ© ÙÙŠ Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯ Ø­Ø°ÙÙ‡');
                }
            }
        }
        function deleteFullTable() { if(activeTable && confirm('Ø­Ø°Ù Ø§Ù„Ø¬Ø¯ÙˆÙ„ØŸ')) activeTable.closest('.editable-block').remove(); }
        
        // ===============================================
        // Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø­Ø¬Ù… Ø§Ù„Ø®Ø·
        // ===============================================
        function applyFontSize(size) {
            const unit = document.getElementById('fontSizeUnit').value;
            const fontSize = size + unit;
            
            if(selectedCells.length > 0) {
                // ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ù„Ø§ÙŠØ§ Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
                selectedCells.forEach(cell => {
                    cell.style.fontSize = fontSize;
                });
            } else {
                // ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù„Ù‰ Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø­Ø¯Ø¯
                const selection = window.getSelection();
                if(selection.rangeCount > 0 && !selection.isCollapsed) {
                    const range = selection.getRangeAt(0);
                    const span = document.createElement('span');
                    span.style.fontSize = fontSize;
                    try {
                        range.surroundContents(span);
                    } catch(e) {
                        // Ø¥Ø°Ø§ ÙØ´Ù„ surroundContentsØŒ Ù†Ø³ØªØ®Ø¯Ù… Ø·Ø±ÙŠÙ‚Ø© Ø¨Ø¯ÙŠÙ„Ø©
                        const contents = range.extractContents();
                        span.appendChild(contents);
                        range.insertNode(span);
                    }
                    selection.removeAllRanges();
                    selection.addRange(range);
                } else {
                    // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ Ù†Øµ Ù…Ø­Ø¯Ø¯ØŒ Ù†Ø·Ø¨Ù‚ Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ø­Ø§Ù„ÙŠ
                    const activeElement = document.activeElement;
                    if(activeElement && (activeElement.contentEditable === 'true' || activeElement.tagName === 'TD' || activeElement.tagName === 'TH')) {
                        activeElement.style.fontSize = fontSize;
                    } else {
                        // ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù„Ù‰ ÙƒÙ„ Ø§Ù„Ù†Øµ ÙÙŠ contenteditable
                        document.execCommand('fontSize', false, '7');
                        const spans = document.querySelectorAll('font[size="7"]');
                        spans.forEach(span => {
                            const fontSize = document.getElementById('fontSizeInput').value + document.getElementById('fontSizeUnit').value;
                            span.style.fontSize = fontSize;
                        });
                    }
                }
            }
        }
        
        function quickFontSize(size) {
            document.getElementById('fontSizeInput').value = size;
            applyFontSize(size);
        }

        // ===============================================
        // Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„ØµÙˆØ±
        // ===============================================
        function selectImage() {
            if(!selectedImage) {
                const images = document.querySelectorAll('.resizable-img-wrapper');
                if(images.length === 0) return alert('Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙˆØ± ÙÙŠ Ø§Ù„ØµÙØ­Ø©');
                if(images.length === 1) {
                    selectedImage = images[0];
                    images[0].classList.add('selected-img');
                } else {
                    alert('Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„ØªÙŠ ØªØ±ÙŠØ¯ ØªØ­Ø¯ÙŠØ¯Ù‡Ø§');
                }
            }
        }
        
        function deleteSelectedImage() {
            if(selectedImage) {
                if(confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„ØµÙˆØ±Ø©ØŸ')) {
                    selectedImage.closest('.editable-block').remove();
                    selectedImage = null;
                }
            } else {
                alert('Ø­Ø¯Ø¯ ØµÙˆØ±Ø© Ø£ÙˆÙ„Ø§Ù‹');
            }
        }
        
        function resizeImage(percent) {
            if(!selectedImage) return alert('Ø­Ø¯Ø¯ ØµÙˆØ±Ø© Ø£ÙˆÙ„Ø§Ù‹');
            const img = selectedImage.querySelector('img');
            if(!img) return;
            
            const currentWidth = parseInt(getComputedStyle(selectedImage).width) || img.naturalWidth;
            const newWidth = (currentWidth * percent) / 100;
            selectedImage.style.width = newWidth + 'px';
        }
        
        function alignImage(align) {
            if(!selectedImage) return alert('Ø­Ø¯Ø¯ ØµÙˆØ±Ø© Ø£ÙˆÙ„Ø§Ù‹');
            const block = selectedImage.closest('.editable-block');
            if(block) {
                block.style.textAlign = align;
            }
        }
        
        // ===============================================
        // Ø§Ù„Ù‡ÙˆØ§Ù…Ø´ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ© ÙˆØ§Ù„Ø®Ø§Ø±Ø¬ÙŠØ© Ù„Ù„ØµÙˆØ±
        // ===============================================
        function showImageMargins() {
            if(!selectedImage) return alert('Ø­Ø¯Ø¯ ØµÙˆØ±Ø© Ø£ÙˆÙ„Ø§Ù‹');
            const controls = selectedImage.querySelector('.img-margin-controls');
            const imgControls = selectedImage.querySelector('.img-controls');
            if(controls) {
                const isVisible = controls.style.display === 'flex';
                controls.style.display = isVisible ? 'none' : 'flex';
                // Ø¥Ø®ÙØ§Ø¡ Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø£Ø®Ø±Ù‰ Ø¹Ù†Ø¯ Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù‡ÙˆØ§Ù…Ø´
                if(!isVisible && imgControls) {
                    imgControls.style.display = 'none';
                }
            }
        }
        
        // ===============================================
        // Toggle Sidebar
        // ===============================================
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('active');
        }
        
        // ===============================================
        // ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø¨ÙˆØ±Ø¯Ø±
        // ===============================================
        function showBorderControls() {
            if(!selectedBlock) {
                alert('Ø­Ø¯Ø¯ Ù…Ø­ØªÙˆÙ‰ Ø£ÙˆÙ„Ø§Ù‹ (Ù†ØµØŒ Ø¹Ù†ÙˆØ§Ù†ØŒ ÙÙ‚Ø±Ø©)');
                return;
            }
            const borderControls = selectedBlock.querySelector('.border-controls');
            if(borderControls) {
                borderControls.style.display = borderControls.style.display === 'none' ? 'flex' : 'none';
            }
        }
        
        function showWidthControls() {
            if(!selectedBlock && !activeTable) {
                alert('Ø­Ø¯Ø¯ Ù…Ø­ØªÙˆÙ‰ Ø£Ùˆ Ø¬Ø¯ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹');
                return;
            }
            const target = selectedBlock || (activeTable ? activeTable.closest('.editable-block') : null);
            if(!target) {
                alert('Ø­Ø¯Ø¯ Ù…Ø­ØªÙˆÙ‰ Ø£Ùˆ Ø¬Ø¯ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹');
                return;
            }
            const widthControls = target.querySelector('.width-controls');
            if(widthControls) {
                widthControls.style.display = widthControls.style.display === 'none' ? 'flex' : 'none';
            }
        }
        
        function setWidth(value) {
            const target = selectedBlock || (activeTable ? activeTable.closest('.editable-block') : null);
            if(!target) {
                alert('Ø­Ø¯Ø¯ Ù…Ø­ØªÙˆÙ‰ Ø£Ùˆ Ø¬Ø¯ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹');
                return;
            }
            
            if(value === 'auto') {
                target.style.width = 'auto';
            } else if(value === 'fit-content') {
                target.style.width = 'fit-content';
            } else {
                target.style.width = value;
            }
            
            // Ù„Ù„Ø¬Ø¯Ø§ÙˆÙ„ØŒ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¹Ø±Ø¶ Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù†ÙØ³Ù‡
            if(activeTable) {
                activeTable.style.width = target.style.width;
            }
        }
        
        function setCustomWidth() {
            const target = selectedBlock || (activeTable ? activeTable.closest('.editable-block') : null);
            if(!target) {
                alert('Ø­Ø¯Ø¯ Ù…Ø­ØªÙˆÙ‰ Ø£Ùˆ Ø¬Ø¯ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹');
                return;
            }
            
            const customWidth = document.getElementById('customWidth').value;
            if(customWidth) {
                target.style.width = customWidth;
                if(activeTable) {
                    activeTable.style.width = customWidth;
                }
            }
        }
        
        function setMinWidth() {
            const target = selectedBlock || (activeTable ? activeTable.closest('.editable-block') : null);
            if(!target) {
                alert('Ø­Ø¯Ø¯ Ù…Ø­ØªÙˆÙ‰ Ø£Ùˆ Ø¬Ø¯ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹');
                return;
            }
            
            const minWidth = document.getElementById('minWidth').value;
            if(minWidth) {
                target.style.minWidth = minWidth;
                if(activeTable) {
                    activeTable.style.minWidth = minWidth;
                }
            }
        }
        
        function setMaxWidth() {
            const target = selectedBlock || (activeTable ? activeTable.closest('.editable-block') : null);
            if(!target) {
                alert('Ø­Ø¯Ø¯ Ù…Ø­ØªÙˆÙ‰ Ø£Ùˆ Ø¬Ø¯ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹');
                return;
            }
            
            const maxWidth = document.getElementById('maxWidth').value;
            if(maxWidth) {
                target.style.maxWidth = maxWidth;
                if(activeTable) {
                    activeTable.style.maxWidth = maxWidth;
                }
            }
        }
        
        function setDisplayMode(mode) {
            const target = selectedBlock || (activeTable ? activeTable.closest('.editable-block') : null);
            if(!target) {
                alert('Ø­Ø¯Ø¯ Ù…Ø­ØªÙˆÙ‰ Ø£Ùˆ Ø¬Ø¯ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹');
                return;
            }
            
            target.style.display = mode;
            
            // Ù„Ù„Ø¬Ø¯Ø§ÙˆÙ„ØŒ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ø¹Ø±Ø¶ ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­
            if(activeTable && mode === 'inline-block') {
                activeTable.style.display = 'inline-table';
            }
        }
        
        function applyBorder(property, value) {
            if(!selectedBlock) return;
            
            if(property === 'style') {
                selectedBlock.style.borderStyle = value;
                if(value === 'none') {
                    selectedBlock.style.border = 'none';
                }
            } else if(property === 'width') {
                selectedBlock.style.borderWidth = value;
            } else if(property === 'color') {
                selectedBlock.style.borderColor = value;
            }
            
            // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¨ÙˆØ±Ø¯Ø±
            if(selectedBlock.style.borderStyle !== 'none') {
                if(!selectedBlock.style.borderWidth) selectedBlock.style.borderWidth = '1px';
                if(!selectedBlock.style.borderColor) selectedBlock.style.borderColor = '#000';
            }
        }
        
        // ===============================================
        // ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø¹Ø±Ø¶
        // ===============================================
        function showWidthControls() {
            if(!selectedBlock && !activeTable) {
                alert('Ø­Ø¯Ø¯ Ù…Ø­ØªÙˆÙ‰ Ø£Ùˆ Ø¬Ø¯ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹');
                return;
            }
            const target = selectedBlock || (activeTable ? activeTable.closest('.editable-block') : null);
            if(!target) {
                alert('Ø­Ø¯Ø¯ Ù…Ø­ØªÙˆÙ‰ Ø£Ùˆ Ø¬Ø¯ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹');
                return;
            }
            const widthControls = target.querySelector('.width-controls');
            if(widthControls) {
                widthControls.style.display = widthControls.style.display === 'none' ? 'flex' : 'none';
            }
        }
        
        function setWidth(value) {
            const target = selectedBlock || (activeTable ? activeTable.closest('.editable-block') : null);
            if(!target) {
                alert('Ø­Ø¯Ø¯ Ù…Ø­ØªÙˆÙ‰ Ø£Ùˆ Ø¬Ø¯ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹');
                return;
            }
            
            if(value === 'auto') {
                target.style.width = 'auto';
            } else if(value === 'fit-content') {
                target.style.width = 'fit-content';
            } else {
                target.style.width = value;
            }
            
            // Ù„Ù„Ø¬Ø¯Ø§ÙˆÙ„ØŒ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¹Ø±Ø¶ Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù†ÙØ³Ù‡
            if(activeTable) {
                activeTable.style.width = target.style.width;
            }
        }
        
        function setCustomWidth() {
            const target = selectedBlock || (activeTable ? activeTable.closest('.editable-block') : null);
            if(!target) {
                alert('Ø­Ø¯Ø¯ Ù…Ø­ØªÙˆÙ‰ Ø£Ùˆ Ø¬Ø¯ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹');
                return;
            }
            
            const customWidth = document.getElementById('customWidth').value;
            if(customWidth) {
                target.style.width = customWidth;
                if(activeTable) {
                    activeTable.style.width = customWidth;
                }
            }
        }
        
        function setMinWidth() {
            const target = selectedBlock || (activeTable ? activeTable.closest('.editable-block') : null);
            if(!target) {
                alert('Ø­Ø¯Ø¯ Ù…Ø­ØªÙˆÙ‰ Ø£Ùˆ Ø¬Ø¯ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹');
                return;
            }
            
            const minWidth = document.getElementById('minWidth').value;
            if(minWidth) {
                target.style.minWidth = minWidth;
                if(activeTable) {
                    activeTable.style.minWidth = minWidth;
                }
            }
        }
        
        function setMaxWidth() {
            const target = selectedBlock || (activeTable ? activeTable.closest('.editable-block') : null);
            if(!target) {
                alert('Ø­Ø¯Ø¯ Ù…Ø­ØªÙˆÙ‰ Ø£Ùˆ Ø¬Ø¯ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹');
                return;
            }
            
            const maxWidth = document.getElementById('maxWidth').value;
            if(maxWidth) {
                target.style.maxWidth = maxWidth;
                if(activeTable) {
                    activeTable.style.maxWidth = maxWidth;
                }
            }
        }
        
        function setDisplayMode(mode) {
            const target = selectedBlock || (activeTable ? activeTable.closest('.editable-block') : null);
            if(!target) {
                alert('Ø­Ø¯Ø¯ Ù…Ø­ØªÙˆÙ‰ Ø£Ùˆ Ø¬Ø¯ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹');
                return;
            }
            
            target.style.display = mode;
            
            // Ù„Ù„Ø¬Ø¯Ø§ÙˆÙ„ØŒ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ø¹Ø±Ø¶ ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­
            if(activeTable && mode === 'inline-block') {
                activeTable.style.display = 'inline-table';
            } else if(activeTable) {
                activeTable.style.display = 'table';
            }
        }
        
        // ===============================================
        // ØªØ­ÙƒÙ… ÙÙŠ Ù‡ÙˆØ§Ù…Ø´ Ø§Ù„ØµÙØ­Ø©
        // ===============================================
        function togglePageMargins() {
            let marginControls = document.querySelector('.page-margin-controls');
            if(!marginControls) {
                // Ø¥Ù†Ø´Ø§Ø¡ Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ­ÙƒÙ…
                marginControls = document.createElement('div');
                marginControls.className = 'page-margin-controls';
                marginControls.innerHTML = `
                    <h3>Ù‡ÙˆØ§Ù…Ø´ Ø§Ù„ØµÙØ­Ø©</h3>
                    <div class="margin-control-group">
                        <label>Ø¹Ù„ÙˆÙŠ:</label>
                        <input type="number" id="pageMarginTop" value="20" min="0" max="50">
                    </div>
                    <div class="margin-control-group">
                        <label>Ø³ÙÙ„ÙŠ:</label>
                        <input type="number" id="pageMarginBottom" value="20" min="0" max="50">
                    </div>
                    <div class="margin-control-group">
                        <label>Ø£ÙŠÙ…Ù†:</label>
                        <input type="number" id="pageMarginRight" value="20" min="0" max="50">
                    </div>
                    <div class="margin-control-group">
                        <label>Ø£ÙŠØ³Ø±:</label>
                        <input type="number" id="pageMarginLeft" value="20" min="0" max="50">
                    </div>
                    <button onclick="applyPageMargins()" class="primary-btn">ØªØ·Ø¨ÙŠÙ‚</button>
                    <button onclick="togglePageMargins()" class="danger-btn">Ø¥ØºÙ„Ø§Ù‚</button>
                `;
                document.body.appendChild(marginControls);
            }
            
            marginControls.classList.toggle('active');
        }
        
        function applyPageMargins() {
            const top = document.getElementById('pageMarginTop').value || 20;
            const bottom = document.getElementById('pageMarginBottom').value || 20;
            const right = document.getElementById('pageMarginRight').value || 20;
            const left = document.getElementById('pageMarginLeft').value || 20;
            
            document.querySelectorAll('.a4-page').forEach(page => {
                page.style.paddingTop = top + 'mm';
                page.style.paddingBottom = bottom + 'mm';
                page.style.paddingRight = right + 'mm';
                page.style.paddingLeft = left + 'mm';
            });
            
            alert('ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù‡ÙˆØ§Ù…Ø´ Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙØ­Ø§Øª');
        }
        
        // ===============================================
        // Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©
        // ===============================================
        function showHelp() {
            document.getElementById('helpModal').classList.add('active');
        }
        
        function closeHelp() {
            document.getElementById('helpModal').classList.remove('active');
        }
        
        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
        const helpModal = document.getElementById('helpModal');
        if(helpModal) {
            helpModal.addEventListener('click', function(e) {
                if(e.target === this) {
                    closeHelp();
                }
            });
        }
        
        function applyImageMargin(side, value) {
            if(!selectedImage) return;
            selectedImage.style.margin = '';
            const currentMargins = {
                top: parseInt(selectedImage.style.marginTop) || 0,
                right: parseInt(selectedImage.style.marginRight) || 0,
                bottom: parseInt(selectedImage.style.marginBottom) || 0,
                left: parseInt(selectedImage.style.marginLeft) || 0
            };
            currentMargins[side] = parseInt(value) || 0;
            selectedImage.style.marginTop = currentMargins.top + 'px';
            selectedImage.style.marginRight = currentMargins.right + 'px';
            selectedImage.style.marginBottom = currentMargins.bottom + 'px';
            selectedImage.style.marginLeft = currentMargins.left + 'px';
        }
        
        function applyImagePadding(side, value) {
            if(!selectedImage) return;
            const img = selectedImage.querySelector('img');
            if(!img) return;
            img.style.padding = '';
            const currentPadding = {
                top: parseInt(img.style.paddingTop) || 0,
                right: parseInt(img.style.paddingRight) || 0,
                bottom: parseInt(img.style.paddingBottom) || 0,
                left: parseInt(img.style.paddingLeft) || 0
            };
            currentPadding[side] = parseInt(value) || 0;
            img.style.paddingTop = currentPadding.top + 'px';
            img.style.paddingRight = currentPadding.right + 'px';
            img.style.paddingBottom = currentPadding.bottom + 'px';
            img.style.paddingLeft = currentPadding.left + 'px';
        }
        
        // ===============================================
        // Ø­Ø°Ù Ø§Ù„Ù…Ø­ØªÙˆÙ‰ (ØªØ­Ø³ÙŠÙ† Ø²Ø± X)
        // ===============================================
        function deleteBlock(btn) {
            const block = btn.closest('.editable-block');
            if(block && confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ØŸ')) {
                if(selectedImage && selectedImage.closest('.editable-block') === block) {
                    selectedImage = null;
                }
                if(selectedBlock === block) {
                    selectedBlock = null;
                }
                block.remove();
            }
        }
        
        // ===============================================
        // Ø­ÙØ¸ ÙˆØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªÙ†Ø¯
        // ===============================================
        function saveDocument() {
            const workspace = document.getElementById('workspace');
            const data = {
                html: workspace.innerHTML,
                timestamp: new Date().toISOString()
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'document_' + new Date().getTime() + '.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            alert('ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­!');
        }
        
        // ===============================================
        // Ø§Ù„ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ PDF Ùˆ PNG
        // ===============================================
        function showExportMenu() {
            document.getElementById('exportMenu').classList.add('active');
        }
        
        function closeExportMenu() {
            document.getElementById('exportMenu').classList.remove('active');
        }
        
        function exportToPDF() {
            const workspace = document.getElementById('workspace');
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ù…Ù† workspace Ù…Ø¹ Ø±Ø£Ø³ ÙˆØªØ°ÙŠÙŠÙ„ Ø§Ø­ØªØ±Ø§ÙÙŠÙŠÙ†
            const exportContainer = document.createElement('div');
            exportContainer.style.cssText = 'background: white; padding: 0; margin: 0;';
            
            // Ø¥Ø¶Ø§ÙØ© Ø±Ø£Ø³ Ø§Ø­ØªØ±Ø§ÙÙŠ
            const header = document.createElement('div');
            header.className = 'export-header active';
            header.innerHTML = `
                <div class="company-logo">SIGMA SHOES</div>
                <div class="company-full-name">Sigma Shoes EG</div>
                <div class="company-tagline">Ø´Ø±ÙƒØ© Ø³ÙŠØ¬Ù…Ø§ Ù„Ù„Ø£Ø­Ø°ÙŠØ© - Ù…ØµØ± | Sigma Shoes Company - Egypt</div>
            `;
            exportContainer.appendChild(header);
            
            // Ù†Ø³Ø® Ù…Ø­ØªÙˆÙ‰ workspace
            const workspaceClone = workspace.cloneNode(true);
            // Ø¥Ø®ÙØ§Ø¡ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„ØµÙØ­Ø§Øª
            workspaceClone.querySelectorAll('.page-header').forEach(h => {
                h.style.display = 'none';
            });
            exportContainer.appendChild(workspaceClone);
            
            // Ø¥Ø¶Ø§ÙØ© ØªØ°ÙŠÙŠÙ„ Ø§Ø­ØªØ±Ø§ÙÙŠ
            const footer = document.createElement('div');
            footer.className = 'export-footer active';
            footer.innerHTML = `
                <div class="company-name">SIGMA SHOES EG</div>
                <div class="company-details">
                    Ø´Ø±ÙƒØ© Ø³ÙŠØ¬Ù…Ø§ Ù„Ù„Ø£Ø­Ø°ÙŠØ© - Ù…ØµØ± | Sigma Shoes Company - Egypt<br>
                    ØªÙ… Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ ÙÙŠ: ${new Date().toLocaleDateString('ar-EG', { year: 'numeric', month: 'long', day: 'numeric' })} | 
                    ${new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}
                </div>
            `;
            exportContainer.appendChild(footer);
            
            // Ø¥Ø¶Ø§ÙØ© Ù„Ù„ØµÙØ­Ø© Ù…Ø¤Ù‚ØªØ§Ù‹
            document.body.appendChild(exportContainer);
            
            const opt = {
                margin: [5, 5, 5, 5],
                filename: 'Sigma_Shoes_Document_' + new Date().getTime() + '.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { 
                    scale: 2, 
                    useCORS: true,
                    backgroundColor: '#ffffff',
                    logging: false
                },
                jsPDF: { 
                    unit: 'mm', 
                    format: 'a4', 
                    orientation: 'portrait',
                    compress: true
                },
                pagebreak: { mode: ['avoid-all', 'css', 'legacy'] }
            };
            
            closeExportMenu();
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„
            const loadingMsg = document.createElement('div');
            loadingMsg.style.cssText = 'position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:white; padding:20px; border:2px solid #2e7d32; border-radius:10px; z-index:3000; box-shadow:0 4px 20px rgba(0,0,0,0.3);';
            loadingMsg.innerHTML = '<p style="margin:0; font-size:16px; color:#2e7d32;">â³ Ø¬Ø§Ø±ÙŠ ØªØµØ¯ÙŠØ± PDF...</p>';
            document.body.appendChild(loadingMsg);
            
            html2pdf().set(opt).from(exportContainer).save().then(() => {
                document.body.removeChild(exportContainer);
                document.body.removeChild(loadingMsg);
                alert('âœ… ØªÙ… ØªØµØ¯ÙŠØ± PDF Ø¨Ù†Ø¬Ø§Ø­!');
            }).catch(err => {
                document.body.removeChild(exportContainer);
                document.body.removeChild(loadingMsg);
                alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØµØ¯ÙŠØ±: ' + err.message);
            });
        }
        
        function exportToPNG() {
            const workspace = document.getElementById('workspace');
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ù…Ù† workspace Ù…Ø¹ Ø±Ø£Ø³ ÙˆØªØ°ÙŠÙŠÙ„ Ø§Ø­ØªØ±Ø§ÙÙŠÙŠÙ†
            const exportContainer = document.createElement('div');
            exportContainer.style.cssText = 'background: white; padding: 0; margin: 0; width: 210mm;';
            
            // Ø¥Ø¶Ø§ÙØ© Ø±Ø£Ø³ Ø§Ø­ØªØ±Ø§ÙÙŠ
            const header = document.createElement('div');
            header.className = 'export-header active';
            header.innerHTML = `
                <div class="company-logo">SIGMA SHOES</div>
                <div class="company-full-name">Sigma Shoes EG</div>
                <div class="company-tagline">Ø´Ø±ÙƒØ© Ø³ÙŠØ¬Ù…Ø§ Ù„Ù„Ø£Ø­Ø°ÙŠØ© - Ù…ØµØ± | Sigma Shoes Company - Egypt</div>
            `;
            exportContainer.appendChild(header);
            
            // Ù†Ø³Ø® Ù…Ø­ØªÙˆÙ‰ workspace
            const workspaceClone = workspace.cloneNode(true);
            // Ø¥Ø®ÙØ§Ø¡ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„ØµÙØ­Ø§Øª
            workspaceClone.querySelectorAll('.page-header').forEach(h => {
                h.style.display = 'none';
            });
            exportContainer.appendChild(workspaceClone);
            
            // Ø¥Ø¶Ø§ÙØ© ØªØ°ÙŠÙŠÙ„ Ø§Ø­ØªØ±Ø§ÙÙŠ
            const footer = document.createElement('div');
            footer.className = 'export-footer active';
            footer.innerHTML = `
                <div class="company-name">SIGMA SHOES EG</div>
                <div class="company-details">
                    Ø´Ø±ÙƒØ© Ø³ÙŠØ¬Ù…Ø§ Ù„Ù„Ø£Ø­Ø°ÙŠØ© - Ù…ØµØ± | Sigma Shoes Company - Egypt<br>
                    ØªÙ… Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ ÙÙŠ: ${new Date().toLocaleDateString('ar-EG', { year: 'numeric', month: 'long', day: 'numeric' })} | 
                    ${new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}
                </div>
            `;
            exportContainer.appendChild(footer);
            
            // Ø¥Ø¶Ø§ÙØ© Ù„Ù„ØµÙØ­Ø© Ù…Ø¤Ù‚ØªØ§Ù‹
            document.body.appendChild(exportContainer);
            
            closeExportMenu();
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„
            const loadingMsg = document.createElement('div');
            loadingMsg.style.cssText = 'position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:white; padding:20px; border:2px solid #1976d2; border-radius:10px; z-index:3000; box-shadow:0 4px 20px rgba(0,0,0,0.3);';
            loadingMsg.innerHTML = '<p style="margin:0; font-size:16px; color:#1976d2;">â³ Ø¬Ø§Ø±ÙŠ ØªØµØ¯ÙŠØ± PNG...</p>';
            document.body.appendChild(loadingMsg);
            
            html2canvas(exportContainer, {
                scale: 2,
                useCORS: true,
                backgroundColor: '#ffffff',
                logging: false,
                width: exportContainer.scrollWidth,
                height: exportContainer.scrollHeight
            }).then(canvas => {
                canvas.toBlob(function(blob) {
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'Sigma_Shoes_Document_' + new Date().getTime() + '.png';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    document.body.removeChild(exportContainer);
                    document.body.removeChild(loadingMsg);
                    alert('âœ… ØªÙ… ØªØµØ¯ÙŠØ± PNG Ø¨Ù†Ø¬Ø§Ø­!');
                }, 'image/png');
            }).catch(err => {
                document.body.removeChild(exportContainer);
                document.body.removeChild(loadingMsg);
                alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØµØ¯ÙŠØ±: ' + err.message);
            });
        }
        
        // Ø¥ØºÙ„Ø§Ù‚ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØµØ¯ÙŠØ± Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
        const exportMenu = document.getElementById('exportMenu');
        if(exportMenu) {
            exportMenu.addEventListener('click', function(e) {
                if(e.target === this) {
                    closeExportMenu();
                }
            });
        }
        
        function clearPage() {
            if(confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ ÙƒÙ„ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©ØŸ')) {
                const page = document.querySelectorAll('.a4-page')[document.querySelectorAll('.a4-page').length - 1];
                page.innerHTML = '<div class="page-content"></div><div class="page-footer"><div class="company-name">SIGMA SHOES EG</div><div class="company-info">Ø´Ø±ÙƒØ© Ø³ÙŠØ¬Ù…Ø§ Ù„Ù„Ø£Ø­Ø°ÙŠØ© - Ù…ØµØ±</div><div class="company-info">Sigma Shoes Company - Egypt</div><div class="print-date" id="printDate1"></div></div>';
                updatePrintDate('printDate1');
                selectedImage = null;
                selectedBlock = null;
                selectedCells = [];
                activeTable = null;
            }
        }
        
        // ===============================================
        // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø¹Ø§Ù„Ø¬Ø§Øª Ø§Ù„ØµÙˆØ± (Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ø´ØªØ±Ùƒ)
        // ===============================================
        function setupImageHandlers(wrapper) {
            const img = wrapper.querySelector('img');
            if(!img) return;
            
            // Ø¥Ø¹Ø¯Ø§Ø¯ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù‚Ø§Ø¨Ø¶
            const handles = {
                'bottom-right': wrapper.querySelector('.img-handle.bottom-right'),
                'bottom-left': wrapper.querySelector('.img-handle.bottom-left'),
                'top-right': wrapper.querySelector('.img-handle.top-right'),
                'top-left': wrapper.querySelector('.img-handle.top-left')
            };
            
            Object.keys(handles).forEach(key => {
                const handle = handles[key];
                if(!handle) return;
                
                let startX, startY, startW, startH;
                handle.addEventListener('mousedown', e => {
                    e.preventDefault();
                    e.stopPropagation();
                    startX = e.clientX;
                    startY = e.clientY;
                    startW = parseInt(getComputedStyle(wrapper).width);
                    startH = parseInt(getComputedStyle(wrapper).height) || (startW * img.naturalHeight / img.naturalWidth);
                    
                    const move = e => {
                        let deltaX, deltaY;
                        if(key.includes('right')) {
                            deltaX = startX - e.clientX;
                        } else {
                            deltaX = e.clientX - startX;
                        }
                        if(key.includes('bottom')) {
                            deltaY = e.clientY - startY;
                        } else {
                            deltaY = startY - e.clientY;
                        }
                        
                        const newW = Math.max(50, startW + (key.includes('right') ? deltaX : -deltaX));
                        const newH = newW * img.naturalHeight / img.naturalWidth;
                        wrapper.style.width = newW + 'px';
                        wrapper.style.height = newH + 'px';
                    };
                    
                    const stop = () => {
                        document.removeEventListener('mousemove', move);
                        document.removeEventListener('mouseup', stop);
                    };
                    
                    document.addEventListener('mousemove', move);
                    document.addEventListener('mouseup', stop);
                });
            });
        }
        
        // ===============================================
        // Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±Ø© Ù…Ø¹ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙØ­Ø©
        // ===============================================
        function addImageWithPageSelect() {
            const pages = document.querySelectorAll('.page-container');
            if(pages.length === 0) {
                alert('Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙØ­Ø§Øª. Ø£Ø¶Ù ØµÙØ­Ø© Ø£ÙˆÙ„Ø§Ù‹.');
                return;
            }
            
            if(pages.length === 1) {
                // ØµÙØ­Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø· - ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„Ù†Ù‚Ø± Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙˆØ±Ø©
                enableClickToInsert('image');
                alert('Ø§Ù†Ù‚Ø± ÙÙŠ Ø§Ù„Ù…ÙƒØ§Ù† Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙˆØ±Ø©');
            } else {
                // Ø¹Ø¯Ø© ØµÙØ­Ø§Øª - Ø§Ø®ØªØ± Ø§Ù„ØµÙØ­Ø©
                const selectedPage = prompt(`Ø§Ø®ØªØ± Ø±Ù‚Ù… Ø§Ù„ØµÙØ­Ø© (1-${pages.length}):\n${Array.from(pages).map((p, i) => `${i+1}. ${p.querySelector('.page-header span').textContent}`).join('\n')}`);
                
                if(selectedPage) {
                    const pageIndex = parseInt(selectedPage) - 1;
                    if(pageIndex >= 0 && pageIndex < pages.length) {
                        window.selectedPageForImage = pages[pageIndex].id;
                        enableClickToInsert('image');
                        alert('Ø§Ù†Ù‚Ø± ÙÙŠ Ø§Ù„Ù…ÙƒØ§Ù† Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙˆØ±Ø©');
                    }
                }
            }
        }
        
        function handleImageUpload(i) {
            if(i.files[0]) { 
                const r=new FileReader(); 
                r.onload=e=>{
                    let pageContent;
                    if(window.clickPositionForImage) {
                        // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø­Ø¯Ø¯ Ø¨Ø§Ù„Ù†Ù‚Ø±
                        pageContent = window.clickPositionForImage.pageContent;
                        window.clickPositionForImage = null;
                    } else if(window.selectedPageForImage) {
                        pageContent = document.getElementById(window.selectedPageForImage).querySelector('.page-content');
                        window.selectedPageForImage = null;
                    } else {
                        pageContent = document.querySelectorAll('.page-content')[document.querySelectorAll('.page-content').length-1];
                    }
                    
                    const d=document.createElement('div'); 
                    d.className='editable-block'; 
                    d.style.textAlign='center';
                    d.style.position='relative';
                    d.style.margin='10px 0';
                    d.style.display='inline-block';
                    d.style.width='100%';
                    
                    d.innerHTML=`<div class="block-tools"><button class="mini-btn danger-btn" onclick="deleteBlock(this)">X</button></div>
                        <div class="resizable-img-wrapper selected-img" style="position:relative; display:inline-block; width:200px; margin:10px auto;">
                            <img src="${e.target.result}" style="max-width:100%; height:auto; display:block;">
                            <div class="img-handle bottom-right"></div>
                            <div class="img-handle bottom-left"></div>
                            <div class="img-handle top-right"></div>
                            <div class="img-handle top-left"></div>
                            <div class="img-controls">
                                <button onclick="resizeImage(50)" title="ØªØµØºÙŠØ±">ğŸ”½</button>
                                <button onclick="resizeImage(100)" title="Ø¹Ø§Ø¯ÙŠ">â¹ï¸</button>
                                <button onclick="resizeImage(150)" title="ØªÙƒØ¨ÙŠØ±">ğŸ”¼</button>
                                <button onclick="alignImage('left')">â¬…ï¸</button>
                                <button onclick="alignImage('center')">âºï¸</button>
                                <button onclick="alignImage('right')">â¡ï¸</button>
                                <button class="danger-btn" onclick="deleteBlock(this)">ğŸ—‘ï¸</button>
                            </div>
                            <div class="img-margin-controls">
                                <div class="margin-input-group">
                                    <label>Ù‡Ø§Ù…Ø´ Ø¹Ù„ÙˆÙŠ:</label>
                                    <input type="number" id="marginTop" value="0" min="0" onchange="applyImageMargin('top', this.value)">
                                </div>
                                <div class="margin-input-group">
                                    <label>Ù‡Ø§Ù…Ø´ Ø³ÙÙ„ÙŠ:</label>
                                    <input type="number" id="marginBottom" value="0" min="0" onchange="applyImageMargin('bottom', this.value)">
                                </div>
                                <div class="margin-input-group">
                                    <label>Ù‡Ø§Ù…Ø´ Ø£ÙŠÙ…Ù†:</label>
                                    <input type="number" id="marginRight" value="0" min="0" onchange="applyImageMargin('right', this.value)">
                                </div>
                                <div class="margin-input-group">
                                    <label>Ù‡Ø§Ù…Ø´ Ø£ÙŠØ³Ø±:</label>
                                    <input type="number" id="marginLeft" value="0" min="0" onchange="applyImageMargin('left', this.value)">
                                </div>
                                <div class="margin-input-group">
                                    <label>Padding Ø¹Ù„ÙˆÙŠ:</label>
                                    <input type="number" id="paddingTop" value="0" min="0" onchange="applyImagePadding('top', this.value)">
                                </div>
                                <div class="margin-input-group">
                                    <label>Padding Ø³ÙÙ„ÙŠ:</label>
                                    <input type="number" id="paddingBottom" value="0" min="0" onchange="applyImagePadding('bottom', this.value)">
                                </div>
                                <div class="margin-input-group">
                                    <label>Padding Ø£ÙŠÙ…Ù†:</label>
                                    <input type="number" id="paddingRight" value="0" min="0" onchange="applyImagePadding('right', this.value)">
                                </div>
                                <div class="margin-input-group">
                                    <label>Padding Ø£ÙŠØ³Ø±:</label>
                                    <input type="number" id="paddingLeft" value="0" min="0" onchange="applyImagePadding('left', this.value)">
                                </div>
                            </div>
                        </div>`;
                    pageContent.appendChild(d);
                    
                    const wrapper = d.querySelector('.resizable-img-wrapper');
                    selectedImage = wrapper;
                    setupImageHandlers(wrapper);
                    
                    // Ø¬Ø¹Ù„ Ø§Ù„ØµÙˆØ±Ø© Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ø³Ø­Ø¨
                    d.classList.add('draggable-text');
                    makeDraggable(d);
                }; 
                r.readAsDataURL(i.files[0]); 
            } 
            i.value='';
        }
        
        let pn=1;
        function addPage() {
            pn++; const id='p'+pn; const d=document.createElement('div'); d.id=id; d.className='page-container';
            const dateId = 'printDate' + pn;
            d.innerHTML=`<div class="page-header"><span>ØµÙØ­Ø© ${pn}</span><div style="display:flex; gap:5px;"><button onclick="printThisPage('${id}')" class="primary-btn" style="padding:2px 8px; font-size:11px;">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button><button onclick="deletePage('${id}')" class="danger-btn" style="padding:2px 8px; font-size:11px;" title="Ø­Ø°Ù Ø§Ù„ØµÙØ­Ø©">ğŸ—‘ï¸ Ø­Ø°Ù</button></div></div><div class="a4-page"><div class="page-content"></div><div class="page-footer"><div class="company-name">SIGMA SHOES EG</div><div class="company-info">Ø´Ø±ÙƒØ© Ø³ÙŠØ¬Ù…Ø§ Ù„Ù„Ø£Ø­Ø°ÙŠØ© - Ù…ØµØ±</div><div class="company-info">Sigma Shoes Company - Egypt</div><div class="print-date" id="${dateId}"></div></div></div>`;
            document.getElementById('workspace').appendChild(d); 
            updatePrintDate(dateId);
            setTimeout(() => {
                d.scrollIntoView({behavior:'smooth', block:'nearest'});
            }, 100);
        }
        
        // ===============================================
        // Ø­Ø°Ù ØµÙØ­Ø© ÙƒØ§Ù…Ù„Ø©
        // ===============================================
        function deletePage(pageId) {
            const page = document.getElementById(pageId);
            if(!page) return;
            
            const pageNumber = page.querySelector('.page-header span').textContent.replace('ØµÙØ­Ø© ', '');
            const totalPages = document.querySelectorAll('.page-container').length;
            
            if(totalPages <= 1) {
                alert('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­Ø°Ù Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø£Ø®ÙŠØ±Ø©. ÙŠØ¬Ø¨ Ø£Ù† ØªØ¨Ù‚Ù‰ ØµÙØ­Ø© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„.');
                return;
            }
            
            if(confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù ${pageNumber} Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ØŸ`)) {
                page.remove();
                
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ±Ù‚ÙŠÙ… Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©
                const remainingPages = document.querySelectorAll('.page-container');
                remainingPages.forEach((p, index) => {
                    const header = p.querySelector('.page-header span');
                    if(header) {
                        header.textContent = `ØµÙØ­Ø© ${index + 1}`;
                    }
                });
            }
        }
        // ===============================================
        // ØªØ­Ø¯ÙŠØ« ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
        // ===============================================
        function updatePrintDate(dateId) {
            const dateElement = document.getElementById(dateId);
            if(dateElement) {
                const now = new Date();
                const dateStr = now.toLocaleDateString('ar-EG', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
                dateElement.textContent = `ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©: ${dateStr}`;
            }
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
        function updateAllPrintDates() {
            document.querySelectorAll('.print-date').forEach((el, index) => {
                if(!el.id) el.id = 'printDate' + (index + 1);
                updatePrintDate(el.id);
            });
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        if(document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                updateAllPrintDates();
            });
        } else {
            // Ø§Ù„ØµÙØ­Ø© Ù…Ø­Ù…Ù„Ø© Ø¨Ø§Ù„ÙØ¹Ù„
            updateAllPrintDates();
        }
        
        // ===============================================
        // Ø­Ø°Ù Ø§Ù„Ù†Øµ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„ÙŠÙ‡
        // ===============================================
        let deleteClickTimeout = null;
        let lastClickedElement = null;
        
        function deleteTextBlock(element, event) {
            // Ù…Ù†Ø¹ Ø§Ù„Ø­Ø°Ù Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± Ø£Ùˆ Ø¹Ù†ØµØ± ØªØ­ÙƒÙ…
            if(event.target.tagName === 'BUTTON' || 
               event.target.closest('.block-tools') || 
               event.target.closest('.img-controls') ||
               event.target.closest('.img-margin-controls')) {
                return;
            }
            
            const block = element.closest('.editable-block');
            if(!block || !block.classList.contains('deletable-text')) {
                return;
            }
            
            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¹Ù†ØµØ± ÙÙŠ Ø­Ø§Ù„Ø© ØªØ­Ø±ÙŠØ±ØŒ Ù„Ø§ Ù†Ø­Ø°ÙÙ‡
            if(document.activeElement === element || 
               element.contains(document.activeElement) ||
               block.querySelector(':focus')) {
                return; // Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ØªØ­Ø±ÙŠØ±
            }
            
            // Ù…Ù†Ø¹ Ø§Ù„Ø§Ù†ØªØ´Ø§Ø±
            event.stopPropagation();
            
            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù†ÙØ³ Ø§Ù„Ø¹Ù†ØµØ± ØªÙ… Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„ÙŠÙ‡ Ù…Ø±ØªÙŠÙ† Ø¨Ø³Ø±Ø¹Ø©ØŒ Ø§Ø­Ø°ÙÙ‡
            if(lastClickedElement === block && deleteClickTimeout) {
                clearTimeout(deleteClickTimeout);
                deleteClickTimeout = null;
                lastClickedElement = null;
                
                if(confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù†Øµ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ØŸ')) {
                    block.remove();
                }
                return;
            }
            
            // Ø§Ù„Ù†Ù‚Ø± Ø§Ù„Ø£ÙˆÙ„ - Ø§Ù†ØªØ¸Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ù„Ù…Ø¹Ø±ÙØ© Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ù†Ù‚Ø± Ø«Ø§Ù†ÙŠ
            lastClickedElement = block;
            deleteClickTimeout = setTimeout(() => {
                // Ø¥Ø°Ø§ Ù…Ø±Øª 300ms Ø¨Ø¯ÙˆÙ† Ù†Ù‚Ø± Ø«Ø§Ù†ÙŠØŒ Ø§Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø©
                if(confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù†Øµ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ØŸ\n(Ø§Ù†Ù‚Ø± Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ù„Ù„Ø­Ø°Ù Ù…Ø¨Ø§Ø´Ø±Ø©)')) {
                    block.remove();
                }
                deleteClickTimeout = null;
                lastClickedElement = null;
            }, 300);
        }
        
        // Ø­Ø°Ù Ù…Ø¨Ø§Ø´Ø± Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø§Ù„Ù…Ø²Ø¯ÙˆØ¬
        document.addEventListener('dblclick', function(e) {
            const deletable = e.target.closest('.deletable-text');
            if(deletable && !e.target.closest('.block-tools')) {
                clearTimeout(deleteClickTimeout);
                deleteClickTimeout = null;
                lastClickedElement = null;
                
                if(confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù†Øµ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ØŸ')) {
                    deletable.remove();
                }
            }
        });
        
        function printThisPage(id) {
            // ØªØ­Ø¯ÙŠØ« ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
            const page = document.getElementById(id);
            if(page) {
                const dateElement = page.querySelector('.print-date');
                if(dateElement) {
                    updatePrintDate(dateElement.id || 'printDate1');
                }
            }
            
            document.querySelectorAll('.page-container').forEach(c=>c.style.display='none');
            const t=document.getElementById(id); t.style.display='block'; t.style.position='absolute'; t.style.top='0'; t.style.width='100%';
            window.print(); setTimeout(()=>{document.querySelectorAll('.page-container').forEach(c=>{c.style.display='block'; c.style.position='relative';})},500);
        }
    </script>
</body>
</html>
